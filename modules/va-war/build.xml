<?xml version="1.0" encoding="UTF-8"?>
<project name="va-war" default="ejbca-build">
    <description>
            Build file for the OCSP Web components
    </description>

	<dirname property="this.dir" file="${ant.file.va-war}"/>
	<import file="${this.dir}/../build.xml"/>
	
	<property name="build.dir" location="${this.dir}/build"/>
	<property name="build-va.dir" location="${this.dir}/build-va"/>
	<property name="src.dir" location="${this.dir}/src"/>
	<property name="resources.dir" location="${this.dir}/resources"/>

	<path id="compile-common.classpath">
		<path refid="lib.servlet.classpath"/>
		<path refid="lib.log4j.classpath"/>
		<path refid="lib.commons-lang.classpath"/>
		<path refid="lib.jee.classpath"/>
		<path refid="lib.bouncycastle.classpath"/>
	</path>

	<path id="compile-ejbca.classpath">
		<path refid="compile-common.classpath"/>
		<path location="${mod.ejbca-ejb-interface.lib}"/>
		<path location="${mod.ejbca-ejb.lib}"/>
		<path refid="lib.ejbca-util.classpath"/>
	</path>
	
	<path id="compile-va.classpath">
		<path refid="compile-common.classpath"/>
		<pathelement location="${mod.va-ejb-interface.lib}"/>
		<pathelement location="${mod.va-ejb.lib}"/>
		<pathelement location="${mod.va-entity.lib}"/>
	</path>
		
    <target name="clean" description="Clean up this module">
		<delete dir="${build.dir}" />
		<delete dir="${build-va.dir}" />
    	<delete file="${mod.va-war.war}" />
    </target>

    <target name="ejbca-build" description="Build this module" depends="ejbca-compile">
        <war destfile="${mod.va-war.war}" webxml="${resources.dir}/WEB-INF/web-ejbca.xml" basedir="${build.dir}"/>
    </target>

	<target name="va-build" description="Build this module" depends="va-compile">
		<war destfile="${mod.va-war.war}" webxml="${resources.dir}/WEB-INF/web-va.xml" basedir="${build-va.dir}"/>
	</target>

    <target name="ejbca-compile" depends="ejbca-ejb">
    	<mkdir dir="${build.dir}/WEB-INF/classes" />
        <javac srcdir="${src.dir}" destdir="${build.dir}/WEB-INF/classes" debug="on" includeantruntime="no" encoding="iso8859-1" target="${java.target.version}"
			classpathref="compile-ejbca.classpath">
        	<exclude name="org/ejbca/ui/web/protocol/OCSPServletStandAlone.java"/>
        	<exclude name="org/ejbca/core/protocol/ocsp/standalonesession/**"/>
        </javac>
    </target>

	<target name="va-compile" depends="va-ejb">
		<echo message="${mod.va-ejb.lib}"/>
		<mkdir dir="${build-va.dir}/WEB-INF/classes" />
		<javac destdir="${build-va.dir}/WEB-INF/classes" debug="on" includeantruntime="no" encoding="iso8859-1" target="${java.target.version}"
			classpathref="compile-va.classpath">
			<include name="org/ejbca/ui/web/protocol/OCSPServletStandAlone.java"/>
    		<src path="${src.dir}"/>
    		<src path="${ejbca.home}/src/java"/>
		</javac>
	</target>

</project>
