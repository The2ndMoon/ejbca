<?xml version="1.0" encoding="UTF-8"?>
<project name="ejbca-interface" default="build" basedir=".">
    <description>
		EJBCA EJB Interface. Recompiles the EJB 2.1 interfaces generated by XDoclet
    	to verify that we don't have any undesired dependencies.
    	
    	The compile-ejb3 target compiles the new EJB3 interfaces, and will eventually 
    	superscede the old compile compile target
    	
    	Creates a JAR with compiled interfaces. 
    </description>
	
	<dirname property="this.dir" file="${ant.file.ejbca-interface}"/>
	<import file="${this.dir}/../build.xml"/>
	
	<property name="build.dir" location="${this.dir}/build"/>
	<property name="ejb3.build.dir" location="${this.dir}/ejb3build"/>
	<property name="build-ocsp.dir" location="${this.dir}/build-ocsp"/>
	<property name="src-xdoclet.dir" location="${ejbca.home}/tmp/bin/gensrc"/>
	<property name="src.dir" location="${this.dir}/src"/>
	<property name="src-xdoclet-ocsp.dir" location="${ejbca.home}/tmp/bin/ocsp-gensrc"/>

	<path id="compile.classpath">
		<pathelement location="${mod.ejbca-util.lib}" />
		<path refid="lib.jee.classpath"/>
	</path>

    <target name="build" description="Build this module" depends="compile, compile-ejb3">
    	<!--
    	<jar destfile="${mod.ejbca-ejb-interface.lib}" basedir="${build.dir}"/>
    	-->
  	 	<jar destfile="${mod.ejbca-ejb-interface_ejb3.lib}" basedir="${ejb3.build.dir}"/> 
    </target>

    <target name="build-ocsp" description="Build this module" depends="compile-ocsp">
    	<jar destfile="${mod.ocsp-ejb-interface.lib}" basedir="${build-ocsp.dir}"/>
    </target>

    <target name="clean" description="Clean up this module">
		<delete dir="${build.dir}" />
    	<delete dir="${ejb3.build.dir}" />
		<delete dir="${build-ocsp.dir}" />
    	<!-- We temporarily keep the EJB 2.1 interface "static"
		<delete file="${mod.ejbca-ejb-interface.lib}"/>
		-->
    	<delete file="${mod.ejbca-ejb-interface_ejb3.lib}"/>
		<delete file="${mod.ocsp-ejb-interface.lib}"/>
    </target>

    <target name="compile" depends="ejbca-util, ejbca-ejb-interfaces-xdoclet">
    	<mkdir dir="${build.dir}" />
        <javac destdir="${build.dir}" debug="on" includeantruntime="no"
        	encoding="iso8859-1" target="${java.target.version}" classpathref="compile.classpath">
        	<src path="${src-xdoclet.dir}"/>
			<exclude name="org/ejbca/core/ejb/**/*DataLocal*.java"/>
			<exclude name="org/ejbca/core/ejb/**/*SessionSession.java"/>
    	</javac>
    </target>

	<target name="compile-ocsp" depends="ejbca-util, ocsp-ejb-interfaces-xdoclet">
    	<mkdir dir="${build-ocsp.dir}" />
        <javac destdir="${build-ocsp.dir}" debug="on" includeantruntime="no"
        	encoding="iso8859-1" target="${java.target.version}" classpathref="compile.classpath">
        	<src path="${src-xdoclet-ocsp.dir}"/>
			<exclude name="org/ejbca/core/ejb/**/*DataLocal*.java"/>
			<exclude name="org/ejbca/core/ejb/**/*SessionSession.java"/>
    	</javac>
    </target>
	
	<target name="compile-ejb3" depends="ejbca-util">
	    	<mkdir dir="${ejb3.build.dir}" />
	        <javac destdir="${ejb3.build.dir}" debug="on" includeantruntime="no"
	        	encoding="iso8859-1" target="${java.target.version}" classpathref="compile.classpath">
	        	<src path="${src.dir}"/>
	    	</javac>
	    </target>
	
</project>
