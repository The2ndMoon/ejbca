<?xml version="1.0" encoding="UTF-8"?>
<project name="modules" default="showhelp">
    <description>
		Holds targets for building all the different modules. These targets are
    	invoked from other modules that depend on them.
    </description>
	
	<!-- Get the correct relative path when this file is imported. -->
	<dirname property="modules.basedir" file="${ant.file.modules}"/>
	<echo message="${modules.basedir}"></echo>
	
	<import file="${modules.basedir}/build-properties.xml"/>
	<import file="${modules.basedir}/build-helpers.xml"/>

    <target name="showhelp">
        <echo message="Run 'ant -p' to see the available targets." />
    </target>

	<target name="clean" description="Clean all modules">
		<ant antfile="${mod.ejbca-ejb.path}/build.xml" target="clean" inheritall="false"/>
		<ant antfile="${mod.ejbca-ejb-cli.path}/build.xml" target="clean" inheritall="false"/>
		<ant antfile="${mod.ejbca-ejb-interface.path}/build.xml" target="clean" inheritall="false"/>
		<ant antfile="${mod.ejbca-entity.path}/build.xml" target="clean" inheritall="false"/>
		<ant antfile="${mod.ejbca-ws.path}/build.xml" target="clean" inheritall="false"/>
		<ant antfile="${mod.ejbca-ws-cli.path}/build.xml" target="clean" inheritall="false"/>
		<ant antfile="${mod.ejbca-xkms.path}/build.xml" target="clean" inheritall="false"/>
		<ant antfile="${mod.ejbca-xkms-cli.path}/build.xml" target="clean" inheritall="false"/>
		<ant antfile="${mod.externalra.path}/build.xml" target="clean" inheritall="false"/>
		<ant antfile="${mod.externalra-scep.path}/build.xml" target="clean" inheritall="false"/>
		<ant antfile="${mod.clientToolBox.path}/build.xml" target="clean" inheritall="false"/>
		<ant antfile="${mod.systemtests.path}/build.xml" target="clean" inheritall="false"/>
	</target>
	
	<target name="ejbca-entity" description="Build EJBCA JPA entity library">
		<ant antfile="${mod.ejbca-entity.path}/build.xml" target="build" inheritall="false"/>
	</target>

	<target name="ejbca-ejb-interface" description="Build EJBCA EJB interfaces library">
		<ant antfile="${mod.ejbca-ejb-interface.path}/build.xml" target="build" inheritall="false"/>
	</target>

	<target name="ejbca-ejb-cli" description="Build EJBCA EJB CLI">
		<ant antfile="${mod.ejbca-ejb-cli.path}/build.xml" target="build" inheritall="false"/>
	</target>

	<target name="clientToolBox" description="Build EJBCA client toolbox">
		<ant antfile="${mod.clientToolBox.path}/build.xml" target="build" inheritall="false"/>
	</target>

	<target name="ejbca-util" description="Build EJBCA util library">
		<ant antfile="${mod.ejbca-ejb.path}/build.xml" target="build-util" inheritall="false"/>
	</target>

	<target name="ejbca-ws" if="ejbcaws.enabled.true" description="Build EJBCA Web Services">
		<ant antfile="${mod.ejbca-ws.path}/build.xml" target="build" inheritall="false"/>
	</target>

	<target name="ejbca-ws-wsdl" description="Generate the EJBCA Web Services WSDL">
		<ant antfile="${mod.ejbca-ws.path}/build.xml" target="generate-wsdl" inheritall="false"/>
	</target>

	<target name="ejbca-ws-common" description="Build the EJBCA Web Services common library">
		<ant antfile="${mod.ejbca-ws.path}/build.xml" target="build-jar" inheritall="false"/>
	</target>

	<target name="ejbca-ws-cli" if="ejbcaws.enabled.true" description="Build EJBCA Web Services CLI">
		<ant antfile="${mod.ejbca-ws-cli.path}/build.xml" target="build" inheritall="false"/>
	</target>

	<target name="ejbca-ws-generate" description="Generate the EJBCA Web Services server and client source code files (used by developers of new WS API calls)">
		<ant antfile="${mod.ejbca-ws.path}/build.xml" target="generate" inheritall="false"/>
		<ant antfile="${mod.ejbca-ws-cli.path}/build.xml" target="generate" inheritall="false"/>
	</target>

	<target name="ejbca-xkms" if="xkms.enabled.true" description="Build the EJBCA XKMS">
		<ant antfile="${mod.ejbca-xkms.path}/build.xml" target="build" inheritall="false"/>
	</target>

	<target name="ejbca-xkms-common" description="Build the EJBCA XKMS common library">
		<ant antfile="${mod.ejbca-xkms.path}/build.xml" target="build-jar" inheritall="false"/>
	</target>

	<target name="ejbca-xkms-cli" if="xkms.enabled.true" description="Build the EJBCA XKMS CLI">
		<ant antfile="${mod.ejbca-xkms-cli.path}/build.xml" target="build" inheritall="false"/>
	</target>

	<target name="externalra-service" if="externalra.enabled.true" description="Build the EJBCA External RA Service">
		<ant antfile="${mod.externalra.path}/build.xml" target="build-service" inheritall="false"/>
	</target>

	<target name="externalra-client" description="Build the EJBCA External RA Service CLI">
		<ant antfile="${mod.externalra.path}/build.xml" target="build-client" inheritall="false"/>
	</target>

	<target name="externalra-library" if="externalra.enabled.true" description="Build the EJBCA External RA Service library">
		<ant antfile="${mod.externalra.path}/build.xml" target="build-library" inheritall="false"/>
	</target>

	<target name="externalra-scep" description="Build the EJBCA External RA StandAlone SCEP WAR">
		<ant antfile="${mod.externalra-scep.path}/build.xml" target="build" inheritall="false"/>
	</target>

	<!-- Some libraries are built using the old system. We have to do a workaround the lack of dependency control for now. -->
	<target name="ejbca-ejb" description="Build EJBCA EJB module">
		<available file="${mod.ejbca-ejb.lib}" property="mod.ejbca-ejb.lib.exists"/>
		<antcall target="ejbca-ejb-internal"/>
	</target>
	<target name="ejbca-ejb-internal" unless="mod.ejbca-ejb.lib.exists">
		<ant dir="${ejbca.home}" antfile="build.xml" target="ejbca-ejb.jar" inheritall="false"/>
	</target>

	<target name="ejbca-ejb-interfaces-xdoclet">
		<available file="${ejbca.home}/tmp/bin/gensrc" type="dir" property="ejbca-ejb-interfaces-xdoclet.ran"></available>
		<antcall target="ejbca-ejb-interfaces-xdoclet-internal"/>
	</target>
	<target name="ejbca-ejb-interfaces-xdoclet-internal" unless="ejbca-ejb-interfaces-xdoclet.ran">
		<ant dir="${ejbca.home}" antfile="build.xml" target="run-xdoc" inheritall="false"/>
	</target>
</project>
