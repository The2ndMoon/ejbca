<?xml version="1.0" encoding="UTF-8"?>
<project name="build-properties">
    <description>
            This file load property files and keeps track of different paths. It should not be run directly. 
    </description>

	<!-- Get the correct relative path when this file is imported. -->
	<dirname property="build-properties.basedir" file="${ant.file.build-properties}"/>
    <property file="${build-properties.basedir}/../src/internal.properties" />
    <property name="ejbca.home" location="${build-properties.basedir}/.." />
    <property environment="env" />
	<!--
		Merge custom modifications from customejbca.home to
		ejbca.home before reading the other configuration files.
	-->
    <property file="${ejbca.home}/conf/custom.properties" />
    <property name="customejbca.home" location="${ejbca.home}/../ejbca-custom" />
    <available file="${customejbca.home}" type="dir" property="customejbca.present" />
    <condition property="customejbca.message" else="No custom changes to merge."
    	value="Merging available external modifications from ${customejbca.home}.">
    	<isset property="customejbca.present" />
    </condition>
	<echo message="${customejbca.message}" />
    <condition property="customejbca.extensions" value="*" else="none-at-all">
    	<isset property="customejbca.present" />
    </condition>
    <condition property="customejbca.dir" value="${customejbca.home}" else="${ejbca.home}/conf">	<!-- This is just any dir that we know exists to avoid error messages.. -->
    	<isset property="customejbca.present" />
    </condition>
	<copy todir="${ejbca.home}" overwrite="true" failonerror="false">
		<fileset dir="${customejbca.dir}" >
			<include name="**/*.${customejbca.extensions}"/>
   		</fileset>
	</copy>
	<!-- Load property files -->
    <property file="${ejbca.home}/conf/${app.name}.properties" />
    <property file="${ejbca.home}/conf/protection.properties" />
    <property file="${ejbca.home}/conf/database.properties" />
    <property file="${ejbca.home}/conf/mail.properties" />
    <property file="${ejbca.home}/conf/ocsp.properties" />
    <property file="${ejbca.home}/conf/web.properties" />
    <property file="${ejbca.home}/conf/cmp.properties" />
    <property file="${ejbca.home}/conf/jaxws.properties" />
    <property file="${ejbca.home}/conf/xkms.properties" />
    <property file="${ejbca.home}/conf/externalra.properties" />
    <property file="${ejbca.home}/conf/scep.properties" />
    <property file="${ejbca.home}/conf/externalra-gui.properties" />

    <!-- httpsserver.hostname must be set cause it's used in preprocess. It will only be set here if not set in any property file -->
    <property name="httpsserver.hostname" value="localhost"/>

    <!-- A little special something to handle backward compatibility with 
         people using JBOSS_HOME. They can switch to APPSRV_HOME now, and both will work. 
    -->        
    <condition property="jboss.home" value="${env.JBOSS_HOME}" >
        <equals arg1="${appserver.home}" arg2="${appserver.home}"/>
    </condition>
    <condition property="appserver.home" value="${env.APPSRV_HOME}" else="${jboss.home}">
        <contains string="${jboss.home}" substring="JBOSS_HOME"/>
    </condition>
	
    <property name="ejbca.dist.path" location="${ejbca.home}/dist" />
    <!-- Define the different modules -->
    <property name="mod.path" location="${ejbca.home}/modules" />
    <property name="mod.common.path" location="${mod.path}/common" />
    <property name="mod.systemtests.path" location="${mod.path}/systemtests" />
    <property name="mod.dist.path" location="${mod.path}/dist" />
    <property name="mod.ejbca-entity.path" location="${mod.path}/ejbca-entity" />
    <property name="mod.ejbca-entity.lib" location="${mod.dist.path}/ejbca-entity.jar" />
    <property name="mod.ejbca-ejb.lib" location="${ejbca.dist.path}/ejbca-ejb.jar" />
    <property name="mod.ejbca-ejb.path" location="${mod.path}/ejbca-ejb" />
    <property name="mod.ejbca-ejb-cli.dist" location="${ejbca.dist.path}/ejbca-ejb-cli" />
    <property name="mod.ejbca-ejb-cli.lib" location="${mod.ejbca-ejb-cli.dist}/ejbca-ejb-cli.jar" />
    <property name="mod.ejbca-ejb-cli.path" location="${mod.path}/ejbca-ejb-cli" />
    <property name="mod.ejbca-ejb-interface.path" location="${mod.path}/ejbca-ejb-interface" />
    <property name="mod.ejbca-ejb-interface.lib" location="${mod.dist.path}/ejbca-ejb-interface.jar" />
    <property name="mod.ejbca-util.lib" location="${ejbca.dist.path}/ejbca-util.jar" />
    <property name="mod.ejbca-ws-cli.dist" location="${ejbca.dist.path}/ejbca-ws-cli" />
    <property name="mod.ejbca-ws-cli.lib" location="${mod.ejbca-ws-cli.dist}/ejbca-ws-cli.jar" />
    <property name="mod.ejbca-ws-cli.path" location="${mod.path}/ejbca-ws-cli" />
    <property name="mod.ejbca-ws.war" location="${mod.dist.path}/ejbcaws.war" />
    <property name="mod.ejbca-ws.path" location="${mod.path}/ejbca-ws" />
    <property name="mod.ejbca-ws.lib" location="${mod.dist.path}/ejbca-ws.jar" />
    <property name="mod.ejbca-ws.wsdl" location="${mod.dist.path}/EjbcaWSService.wsdl" />
    <property name="mod.ejbca-ws.wsdl-schema" location="${mod.dist.path}/EjbcaWSService_schema1.xsd" />
    <property name="mod.ejbca-xkms-cli.lib" location="${ejbca.dist.path}/ejbca-xkms-cli/xkmscli.jar" />
    <property name="mod.ejbca-xkms-cli.dist" location="${ejbca.dist.path}/ejbca-xkms-cli" />
    <property name="mod.ejbca-xkms-cli.path" location="${mod.path}/ejbca-xkms-cli" />
    <property name="mod.ejbca-xkms.path" location="${mod.path}/ejbca-xkms" />
    <property name="mod.ejbca-xkms.war" location="${mod.dist.path}/xkms.war" />
    <property name="mod.ejbca-xkms.lib" location="${mod.dist.path}/ejbca-xkms.jar" />
    <property name="mod.admin-gui.path" location="${mod.path}/admin-gui" />
    <property name="mod.admin-gui.war" location="${mod.dist.path}/adminweb.war" />
    <property name="mod.cmp-war.path" location="${mod.path}/cmp-war" />
    <property name="mod.cmp-war.war" location="${mod.dist.path}/cmp.war" />
    <property name="mod.publicweb-gui.path" location="${mod.path}/publicweb-gui" />
    <property name="mod.publicweb-gui.war" location="${mod.dist.path}/publicweb.war" />
    <property name="mod.scep-war.path" location="${mod.path}/ejbca-scep-war" />
    <property name="mod.scep-war.war" location="${mod.dist.path}/scep.war" />
    <property name="mod.clientToolBox.dist" location="${ejbca.dist.path}/clientToolBox" />
    <property name="mod.clientToolBox.lib" location="${mod.clientToolBox.dist}/clientToolBox.jar" />
    <property name="mod.clientToolBox.path" location="${mod.path}/clientToolBox" />
    <property name="mod.cmpTcpProxy.dist" location="${ejbca.dist.path}/cmpTcpProxy" />
    <property name="mod.cmpHttpProxy.dist" location="${ejbca.dist.path}/cmpHttpProxy" />
    <property name="mod.cmpProxy.path" location="${mod.path}/cmpProxy" />
    <property name="mod.externalra.path" location="${mod.path}/externalra" />
    <property name="mod.externalra.lib" location="${mod.dist.path}/externalra.jar" />
    <property name="mod.externalra-cli.path" location="${ejbca.dist.path}/externalra-cli" />
    <property name="mod.externalra-cli.lib" location="${mod.externalra-cli.path}/externalra-cli.jar" />
    <property name="mod.externalra-gui.path" location="${mod.path}/externalra-gui" />
    <property name="mod.externalra-gui.dist" location="${ejbca.dist.path}/externalra-gui" />
    <property name="mod.externalra-gui.war" location="${mod.externalra-gui.dist}/externalra-gui.war" />
    <property name="mod.externalra-service.lib" location="${mod.dist.path}/externalra-service.jar" />
    <property name="mod.externalra-datasources.dist" location="${ejbca.dist.path}/datasources" />
    <property name="mod.externalra-scep.path" location="${mod.path}/externalra-scep" />
    <property name="mod.externalra-scep.war" location="${ejbca.dist.path}/scepraserver.war" />
	
    <!-- Variables of global interest -->
    <property name="java.target.version" value="1.5"/>	<!-- This should probably be defined in internal.properties -->
	<property name="externalra.enabled" value="false"/>
	<property name="ejbcaws.enabled" value="true" />
	<condition property="ejbcaws.enabled.true"><istrue value="${ejbcaws.enabled}"/></condition>
	<condition property="xkms.enabled.true"><istrue value="${xkms.enabled}"/></condition>
	<condition property="externalra.enabled.true"><istrue value="${externalra.enabled}"/></condition>

	<!-- Files of global interest -->
    <property name="jndi.properties.file" location="${ejbca.home}/src/java/jndi.properties" />
    <property name="profilemappings.properties.file" location="${ejbca.home}/src/java/profilemappings.properties" />
    <property name="log4j.test.file" location="${mod.common.path}/resources/log4j-test.xml" />
    <property name="log4j.cli.file" location="${mod.common.path}/resources/log4j-cli.xml" />
    <property name="internal.properties.file" location="${ejbca.home}/src/internal.properties" />
    
	<!-- Define class-paths of global interest -->
	<path id="lib.cert-cvc.classpath"><fileset dir="${ejbca.home}/lib" includes="cert-cvc.jar"/></path>

	<path id="lib.junit.classpath">
		<fileset dir="${ejbca.home}/lib/ext">
			<include name="junit-*.jar"/>
			<include name="commons-httpclient-*.jar"/>	<!-- ProtocolScepHttpTest -->
			<include name="htmlunit-*.jar"/>	<!-- ProtocolScepHttpTest -->
			<include name="commons-io-*.jar"/>	<!-- ProtocolScepHttpTest -->
		</fileset>
	</path>

	<path id="lib.log4j.classpath"><fileset dir="${ejbca.home}/lib" includes="log4j*.jar"/></path>
	<path id="lib.commons-lang.classpath"><fileset dir="${ejbca.home}/lib" includes="commons-lang-*.jar"/></path>
	<path id="lib.commons-config.classpath"><fileset dir="${ejbca.home}/lib" includes="commons-configuration-*.jar"/></path>
	<path id="lib.commons-collections.classpath"><fileset dir="${ejbca.home}/lib" includes="commons-collections-*.jar"/></path>
	<path id="lib.commons-logging.classpath"><fileset dir="${ejbca.home}/lib" includes="commons-logging*.jar"/></path>
	<path id="lib.commons-el.classpath"><fileset dir="${ejbca.home}/lib" includes="commons-el-*.jar"/></path>
	<path id="lib.commons-fileupload.classpath"><fileset dir="${ejbca.home}/lib" includes="commons-fileupload-*.jar"/></path>
	<path id="lib.jline.classpath"><fileset dir="${ejbca.home}/lib" includes="jline-*.jar"/></path>
	<path id="lib.batik.classpath"><fileset dir="${ejbca.home}/lib/batik" includes="*.jar"/></path>
	<path id="lib.mail.classpath">
		<fileset dir="${ejbca.home}/lib/ext" includes="mail.jar"/>
		<fileset dir="${ejbca.home}/lib/jaxws" includes="activation.jar"/> <!-- Apparently a dependency from JavaMail under Java 5 -->
	</path>
	<path id="lib.servlet.classpath"><fileset dir="${ejbca.home}/lib/ext" includes="servlet-*.jar"/></path>
	<path id="lib.tomahawk.classpath"><fileset dir="${ejbca.home}/lib/myfaces" includes="tomahawk-*.jar"/></path>
	<path id="lib.jline.classpath"><fileset dir="${ejbca.home}/lib" includes="jline-*.jar"/></path>
	<path id="lib.ldap.classpath"><fileset dir="${ejbca.home}/lib" includes="ldap.jar"/></path>
	<path id="lib.xmlsec.classpath"><fileset dir="${ejbca.home}/lib/xmlsign/" includes="xmlsec-*.jar"/></path>
	<path id="lib.clover.classpath"><pathelement location="/home/hudson/clover/clover-ant-2.5.0/lib/clover.jar"/></path>
	

	<path id="lib.utils.classpath">
		<fileset dir="${ejbca.home}/lib">
			<include name="commons-*.jar"/>
			<include name="log4j*.jar"/>
		</fileset>
	</path>

	<property name="lib.jaxws.dir" location="${ejbca.home}/lib/jaxws"/>
	<path id="lib.jaxws-client.classpath">
        <fileset dir="${ejbca.home}/lib/jaxws">
            <include name="jaxb*.jar"/>
            <include name="saaj-*.jar"/>
            <include name="jaxws-api.jar"/>
            <include name="jaxws-rt.jar"/>
            <include name="sjsxp.jar"/>
            <include name="jsr181-api.jar"/>
            <include name="jsr173_api.jar"/>
            <include name="activation.jar"/>
            <include name="libidn.jar"/>
        </fileset>
	</path>

    <fileset id="lib.jaxws.fileset" dir="${ejbca.home}/lib/jaxws" includes="*.jar"/>
	<path id="lib.jaxws.classpath"><fileset refid="lib.jaxws.fileset"/></path>

	<dirname file="${appserver.home}" property="appserver.home.parent"/>

	<path id="lib.jee.classpath">
		<fileset dir="${appserver.home}">
			<!-- JBoss 4.2.x -->
			<include name="client/jbossall-client.jar" /> 	                         
			<include name="client/jboss-j2ee.jar" /> 	 
			<include name="client/jnp-client.jar" />			
			<!-- JBoss 5.0.0 -->
			<include name="client/jboss-javaee.jar" />
			<include name="client/jboss-logging-spi.jar" />
			<include name="client/jboss-client.jar" />
			<include name="client/jboss-security-spi.jar" />
			<include name="client/jboss-serialization.jar" />
			<include name="client/jboss-common-core.jar" />
			<include name="client/jboss-remoting.jar" />
			<include name="client/concurrent.jar" />
			<include name="client/jbosssx-client.jar" />
			<include name="client/jboss-integration.jar" />
			<include name="client/xmlsec.jar" />
			<!-- glassfish v2 -->
			<include name="lib/javaee.jar"/>
			<include name="lib/appserv-rt.jar"/>
			<include name="lib/appserv-ext.jar"/>
			<include name="lib/appserv-deployment-client.jar"/>
			<!-- weblogic -->
			<include name="server/lib/weblogic.jar"/>	<!-- For 9.2 -->
			<include name="server/lib/wlclient.jar"/>	<!-- For 10.3 -->
			<include name="server/lib/webserviceclient.jar"/>	<!-- For 10.3 -->
			<include name="server/lib/wls-api.jar"/>	<!-- For 10.3 -->
			<include name="server/lib/wljmsclient.jar"/>	<!-- For 10.3 -->
			<include name="server/lib/wlsafclient.jar"/>	<!-- For 10.3 -->
			<!-- oracle -->
			<include name="j2ee/home/oc4jclient.jar"/>
			<include name="j2ee/home/lib/ejb.jar"/>
			<!-- websphere -->
			<include name="runtimes/com.ibm.*.jar"/>
		</fileset>
		<fileset dir="${appserver.home.parent}">
			<!-- For WebLogic 10.3.. Why don't they just include dependecies in the client library???? -->
			<include name="modules/com.bea.core.management.core_2.3.0.0.jar"/>
			<include name="modules/com.bea.core.utils.classloaders_1.4.0.0.jar"/>
			<include name="modules/com.bea.core.weblogic.security.identity_1.1.0.0.jar"/>
			<include name="modules/com.bea.core.transaction_2.5.0.0.jar"/>
			<include name="modules/com.bea.core.weblogic.security.wls_1.0.0.0_5-0-2-0.jar"/>
			<include name="modules/com.bea.core.utils_1.4.0.0.jar"/>
			<include name="modules/com.bea.core.weblogic.rmi.client_1.4.0.0.jar"/>
			<include name="modules/com.bea.core.descriptor_1.4.0.0.jar"/>
			<include name="modules/com.bea.core.logging_1.4.0.0.jar"/>
			<include name="modules/com.bea.core.weblogic.socket.api_1.0.0.0.jar"/>
			<include name="modules/com.bea.core.weblogic.security.digest_1.0.0.0.jar"/>
			<include name="modules/com.bea.core.weblogic.workmanager_1.4.0.0.jar"/>
			<include name="modules/com.bea.core.utils.full_1.4.0.0.jar"/>
			<include name="modules/com.bea.core.weblogic.lifecycle_1.1.0.0.jar"/>
			<include name="modules/com.bea.core.utils.wrapper_1.3.0.0.jar"/>
		</fileset>
	</path>
	
	<path id="lib.jsf.classpath">
		<fileset dir="${appserver.home}">
			<!-- jboss -->
			<include name="server/default/deploy/jboss-web.deployer/jsf-libs/jsf-api.jar" /> <!-- 4.2.x -->
			<include name="server/default/deploy/jbossweb.sar/jsf-libs/jsf-api.jar" /> <!-- 5.x -->
			<include name="server/default/deploy/jbossweb.sar/jsf-libs/jsf-impl.jar" /> <!-- 5.x -->
			<include name="server/default/deploy/jbossweb.sar/jstl.jar" /> <!-- 5.x -->
			<include name="common/lib/el-api.jar" /> <!-- 5.x -->
			<!-- glassfish ? -->
			<!-- weblogic ? -->
			<!-- oracle ? -->
			<!-- websphere ? -->
		</fileset>
	</path>
	
	<path id="lib.jsp.classpath">
		<!--
		<fileset dir="${ejbca.home}/lib">
			<include name="myfaces/standard-*.jar" />
		</fileset>
		-->
		<fileset dir="${appserver.home}">
			<!-- jboss -->
			<include name="common/lib/jsp-api.jar" /> <!-- 5.x -->
			<include name="server/default/deploy/jbossweb.sar/jstl.jar" /> <!-- 5.x -->
			<include name="common/lib/el-api.jar" /> <!-- 5.x -->
			<!-- glassfish ? -->
			<!-- weblogic ? -->
			<!-- oracle ? -->
			<!-- websphere ? -->
		</fileset>
	</path>
	
	<path id="lib.jasper.classpath">
		<fileset dir="${appserver.home}">
			<!-- jboss -->
			<include name="server/default/deploy/jbossweb.sar/jasper-jdt.jar" /> <!-- 5.x -->
			<include name="server/default/deploy/jbossweb.sar/jbossweb.jar" /> <!-- 5.x -->
			<include name="common/lib/servlet-api.jar" /> <!-- 5.x -->
			<include name="lib/jboss-logging-spi.jar" /> <!-- 5.x -->
			<!-- glassfish ? -->
			<!-- weblogic ? -->
			<!-- oracle ? -->
			<!-- websphere ? -->
		</fileset>
	</path>
	
	<path id="lib.ejbca-util.classpath">
    	<pathelement location="${ejbca.home}/lib/cert-cvc.jar"/>
    	<pathelement location="${mod.ejbca-util.lib}"/>
	</path>

	<path id="lib.bouncycastle-provonly.classpath"><fileset dir="${ejbca.home}/lib"><include name="bcprov-jdk15.jar"/></fileset></path>
	<path id="lib.bouncycastle-mailonly.classpath"><fileset dir="${ejbca.home}/lib"><include name="bcmail-jdk15.jar"/></fileset></path>
	<path id="lib.bouncycastle.classpath">
		<path refid="lib.bouncycastle-provonly.classpath"/>
		<path refid="lib.bouncycastle-mailonly.classpath"/>
		<fileset dir="${ejbca.home}/lib"><include name="bctsp-jdk15.jar"/></fileset>
	</path>

	<path id="lib.jpa.classpath">
        <fileset dir="${ejbca.home}/lib/xdoclet/lib" includes="dom4j-1.6.1.jar.jar"/>
        <fileset dir="${ejbca.home}/lib/hibernate">
            <include name="antlr-2.7.6.jar"/>
            <include name="hibernate3.jar"/>
            <include name="hibernate-core.jar"/>
            <include name="hibernate-annotations.jar"/>
            <include name="hibernate-commons-annotations.jar"/>
            <include name="hibernate-entitymanager.jar"/>
            <include name="hibernate-search-*.jar"/>
            <include name="lucene-core-*.jar"/>
            <include name="hibernate-validator-*.jar"/>
            <include name="javassist-3.4.GA.jar"/>
            <include name="ejb3-persistence.jar"/>
            <include name="slf4j-api-1.5.2.jar"/>
            <include name="slf4j-log4j12.jar"/>
            <include name="jta-1.1.jar"/>
            <include name="dom4j-*.jar"/>
        </fileset>
	</path>

	<path id="lib.clientToolBox.classpath">
        <path location="${mod.clientToolBox.dist}/properties" />
        <path location="${mod.clientToolBox.lib}" />
        <path>
			<fileset dir="${mod.clientToolBox.dist}/lib" includes="*.jar" />
		</path>
	</path>

	<path id="lib.cmpTcpProxy.classpath">
        <path location="${mod.cmpTcpProxy.dist}/properties" />
        <path location="${mod.cmpTcpProxy.lib}" />
        <path>
			<fileset dir="${mod.cmpTcpProxy.dist}/lib" includes="*.jar" />
		</path>
	</path>

    <!-- Now when everything is set up, we can load the old property defaults -->
	<import file="${build-properties.basedir}/../propertyDefaults.xml"/>


</project>
