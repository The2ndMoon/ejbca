<?xml version="1.0" encoding="UTF-8"?>
<project name="ejbca-ejb" default="build">
    <description>
            The EJBCA EJB component.
    	
    		The EJBCA util library is also built from this source.
    </description>

	<dirname property="this.dir" file="${ant.file.ejbca-ejb}"/>
	<import file="${this.dir}/../build.xml"/>
	
	<property name="build.dir" location="${this.dir}/build"/>
	<property name="build-util.dir" location="${this.dir}/build-util"/>
	<property name="build-temp.dir" location="${this.dir}/build-temp"/>
	<property name="build-test.dir" location="${this.dir}/build-test"/>
	<property name="src.dir" location="${ejbca.home}/src/java"/>
	<property name="src-temp.dir" location="${this.dir}/src-temp"/>
	<property name="src-test.dir" location="${this.dir}/src-test"/>
	<property name="reports.base.dir" location="${this.dir}/build-test/reports/"/>

	<path id="compile.classpath">
		<path refid="compile-util.classpath"/>
	</path>
	
	<path id="compile-util.classpath">
		<path refid="lib.cert-cvc.classpath"/>
		<path refid="lib.bouncycastle.classpath"/>
		<path refid="lib.log4j.classpath"/>
		<path refid="lib.commons-lang.classpath"/>
		<path refid="lib.commons-config.classpath"/>
		<path refid="lib.commons-collections.classpath"/>
		<path refid="lib.commons-logging.classpath"/>
		<path refid="lib.servlet.classpath"/>
		<path refid="lib.jline.classpath"/>
		<path refid="lib.ldap.classpath"/>
		<path refid="lib.mail.classpath"/>
		<path refid="lib.batik.classpath"/>
		<path refid="lib.xmlsec.classpath"/>
		<path refid="lib.jee.classpath"/>
	</path>

	<path id="test.classpath">
		<path location="${build-test.dir}" />
		<path location="${mod.ejbca-ejb.lib}" />
		<path refid="compile.classpath"/>
		<path refid="lib.junit.classpath"/>
	</path>

    <target name="build" description="Build this module" depends="dependecy-check, ejbca-ejb">
    	<!-- This module is still JARed in the old build system -->
    </target>

    <target name="build-util" description="Build the ejbca-util JAR" depends="compile-util">
    	<dirname file="${mod.ejbca-util.lib}" property="mod.ejbca-util.lib.dir"/>
    	<mkdir dir="${mod.ejbca-util.lib.dir}" />
    	<jar destfile="${mod.ejbca-util.lib}">
   			<fileset dir="${build-util.dir}" includes="**/*.class"/>
        	<fileset dir="${ejbca.home}/src/java">
        	    <include name="dncomponents.properties"/>
        		<include name="profilemappings.properties"/>
        	</fileset>
    	</jar>
    </target>

    <target name="clean" description="Clean up this module">
		<delete dir="${build.dir}" />
		<delete dir="${build-util.dir}" />
		<delete dir="${src-temp.dir}" />
		<delete dir="${build-temp.dir}" />
		<delete dir="${build-test.dir}" />
		<delete file="${mod.ejbca-ejb.lib}" />
		<delete file="${mod.ejbca-util.lib}" />
    </target>
	
    <target name="compile">
    	<fail message="This component currently only holds the tests that depends on classes from the EJB component!"/>
    </target>

    <target name="dependecy-check" depends="ejbca-ejb-interfaces-xdoclet" description="Perform a dependency check on the different EJBCA core components">
    	<!--
    		To enforce proper dependencies between different core components of the EJBCA core should be able to
    		compile each component with only the current components dependecies in the classpath. To make sure
    		this happens we need to isolate the source files first.
    		
    		The code below are mainly a temporary help to be able to devide the components into new packages
    		more easily. Ideally each include should only be "org/ejbca/<component>/**/*.java" and each check
    		could be placed in proper reusable sub-targets.
    	-->
    	<mkdir dir="${src-temp.dir}"/>
    	<mkdir dir="${build-temp.dir}"/>
    	<!-- Basic configuration, utils and constants component -->
    	<echo message=" ** Validating component: Basics **"/>
    	<mkdir dir="${src-temp.dir}/common"/>
    	<mkdir dir="${build-temp.dir}/common"/>
    	<copy todir="${src-temp.dir}/common">
    		<fileset dir="${ejbca.home}/tmp/bin/gensrc">
    			<include name="org/ejbca/core/ejb/PropertyEntityPK.java"/>
    		</fileset>
    		<fileset dir="${src.dir}">
    			<include name="org/ejbca/config/ConfigurationHolder.java"/>
    			<include name="org/ejbca/config/EjbcaConfiguration.java"/>
    			<include name="org/ejbca/util/CryptoProviderTools.java"/>
    			<include name="org/ejbca/util/GUIDGenerator.java"/>
    			<include name="org/ejbca/util/JDBCUtil.java"/>
    			<include name="org/ejbca/util/StringTools.java"/>
    			<include name="org/ejbca/util/FileTools.java"/>
    			<include name="org/ejbca/util/Base64.java"/>
    			<include name="org/ejbca/core/ejb/*.java"/>
    			<include name="org/ejbca/core/model/AlgorithmConstants.java"/>
    			<!-- Dependecies from Protect that are pretty general.. -->
    			<include name="org/ejbca/core/model/InternalResources.java"/>
    			<!-- Dependecies from Publisher and Approval that are pretty general.. -->
    			<include name="org/ejbca/core/model/UpgradeableDataHashMap.java"/>
    			<include name="org/ejbca/core/model/IUpgradeableData.java"/>
    			<include name="org/ejbca/core/ErrorCode.java"/>
    			<include name="org/ejbca/core/EjbcaException.java"/>
    			<!-- Dependecies from Publisher that are pretty general.. -->
    			<include name="org/ejbca/util/Base64GetHashMap.java"/>
				<include name="org/ejbca/util/Base64PutHashMap.java"/>
    	    	<!-- SecConst should proabaly be devided into several constants classes.. -->
    			<include name="org/ejbca/core/model/SecConst.java"/>
    		</fileset>
    	</copy>
        <javac srcdir="${src-temp.dir}/common" destdir="${build-temp.dir}/common" debug="on" includeantruntime="no"
        	encoding="iso8859-1" target="${java.target.version}">
        	<classpath>
        		<pathelement location="${build-temp.dir}/config"/>
        		<path refid="compile.classpath"/>
        	</classpath>
        </javac>
    	<!-- Protect component -->
    	<echo message=" ** Validating component: Protect **"/>
    	<mkdir dir="${src-temp.dir}/protect"/>
    	<mkdir dir="${build-temp.dir}/protect"/>
    	<copy todir="${src-temp.dir}/protect">
    		<fileset dir="${ejbca.home}/tmp/bin/gensrc">
    			<include name="org/ejbca/core/ejb/protect/**/*DataLocalHome.java"/>
    			<include name="org/ejbca/core/ejb/protect/**/*DataLocal.java"/>
    			<include name="org/ejbca/core/ejb/protect/**/TableProtectSessionLocal.java"/>
    			<include name="org/ejbca/core/ejb/protect/**/TableProtectSessionLocalHome.java"/>
    			<include name="org/ejbca/core/ejb/protect/**/TableProtectSessionRemote.java"/>
    			<include name="org/ejbca/core/ejb/protect/**/TableProtectSessionHome.java"/>
    		</fileset>
    		<fileset dir="${src.dir}">
    			<include name="org/ejbca/core/ejb/protect/**/*.java"/>
    			<include name="org/ejbca/core/model/protect/**/*.java"/>
    			<include name="org/ejbca/config/ProtectConfiguration.java"/>
    		</fileset>
    	</copy>
        <javac srcdir="${src-temp.dir}/protect" destdir="${build-temp.dir}/protect" debug="on" includeantruntime="no"
        	encoding="iso8859-1" target="${java.target.version}">
        	<classpath>
        		<path refid="compile.classpath"/>
        		<pathelement location="${build-temp.dir}/common"/>
        	</classpath>
        </javac>
    	<!-- AdminObjects component -->
    	<echo message=" ** Validating component: AdminObjects **"/>
    	<mkdir dir="${src-temp.dir}/admins"/>
    	<mkdir dir="${build-temp.dir}/admins"/>
    	<copy todir="${src-temp.dir}/admins">
    		<fileset dir="${src.dir}">
    			<include name="org/ejbca/core/model/log/Admin.java"/>
    			<include name="org/ejbca/core/model/authorization/AdminEntity.java"/>
    			<include name="org/ejbca/core/model/authorization/AdminInformation.java"/>
    			<include name="org/ejbca/util/dn/DNFieldExtractor.java"/>
    			<include name="org/ejbca/util/dn/DnComponents.java"/>
    			<include name="org/ejbca/util/CertTools.java"/>
    			<include name="org/ejbca/core/model/ca/crl/RevokedCertInfo.java"/>
    		</fileset>
    	</copy>
        <javac srcdir="${src-temp.dir}/admins" destdir="${build-temp.dir}/admins" debug="on" includeantruntime="no"
        	encoding="iso8859-1" target="${java.target.version}">
        	<classpath>
        		<path refid="compile.classpath"/>
        		<pathelement location="${build-temp.dir}/common"/>
        	</classpath>
        </javac>
    	<!-- Logging component -->
    	<echo message=" ** Validating component: Logging (except ProtectedLog, CvsExporter) **"/>
    	<mkdir dir="${src-temp.dir}/logging"/>
    	<mkdir dir="${build-temp.dir}/logging"/>
    	<copy todir="${src-temp.dir}/logging">
    		<fileset dir="${ejbca.home}/tmp/bin/gensrc">
    			<include name="org/ejbca/core/ejb/log/**/ILogSessionLocal.java"/>
    			<include name="org/ejbca/core/ejb/log/**/ILogSessionLocalHome.java"/>
    			<include name="org/ejbca/core/ejb/log/**/ILogSessionLocalHome.java"/>
    			<include name="org/ejbca/core/ejb/log/**/LogEntryDataLocalHome.java"/>
    			<include name="org/ejbca/core/ejb/log/**/LogEntryDataLocal.java"/>
    			<include name="org/ejbca/core/ejb/log/**/LogConfigurationDataLocalHome.java"/>
    			<include name="org/ejbca/core/ejb/log/**/LogConfigurationDataLocal.java"/>
    		</fileset>
    		<fileset dir="${src.dir}">
    			<include name="org/ejbca/core/ejb/log/**/*.java"/>
    			<include name="org/ejbca/core/model/log/**/*.java"/>
    			<include name="org/ejbca/config/LogConfiguration.java"/>
    			<include name="org/ejbca/config/OldLogConfiguration.java"/>
    			<include name="org/ejbca/util/query/**/*.java"/>
    			<include name="org/ejbca/util/ObjectCache.java"/>
    			<exclude name="org/ejbca/core/ejb/log/**/ProtectedLog*.java"/>
    			<exclude name="org/ejbca/core/model/log/**/ProtectedLog*.java"/>
    			<exclude name="org/ejbca/core/model/log/**/IProtectedLog*.java"/>
    			<exclude name="org/ejbca/core/model/log/CsvLogExporter.java"/>
    		</fileset>
    	</copy>
        <javac srcdir="${src-temp.dir}/logging" destdir="${build-temp.dir}/logging" debug="on" includeantruntime="no"
        	encoding="iso8859-1" target="${java.target.version}">
        	<classpath>
        		<path refid="compile.classpath"/>
        		<pathelement location="${build-temp.dir}/common"/>
        		<pathelement location="${build-temp.dir}/protect"/>
        		<pathelement location="${build-temp.dir}/admins"/>
        	</classpath>
        </javac>
    	<!-- Authorization component -->
    	<echo message=" ** Validating component: Authorization **"/>
    	<mkdir dir="${src-temp.dir}/authorization"/>
    	<mkdir dir="${build-temp.dir}/authorization"/>
    	<copy todir="${src-temp.dir}/authorization">
    		<fileset dir="${ejbca.home}/tmp/bin/gensrc">
    			<include name="org/ejbca/core/ejb/authorization/**/AdminEntityDataLocal.java"/>
    			<include name="org/ejbca/core/ejb/authorization/**/AdminEntityDataLocalHome.java"/>
    			<include name="org/ejbca/core/ejb/authorization/**/AccessRulesDataLocal.java"/>
    			<include name="org/ejbca/core/ejb/authorization/**/AccessRulesDataLocalHome.java"/>
    			<include name="org/ejbca/core/ejb/authorization/**/AdminGroupDataLocal.java"/>
    			<include name="org/ejbca/core/ejb/authorization/**/AdminGroupDataLocalHome.java"/>
    			<include name="org/ejbca/core/ejb/authorization/**/AuthorizationTreeUpdateDataLocal.java"/>
    			<include name="org/ejbca/core/ejb/authorization/**/AuthorizationTreeUpdateDataLocalHome.java"/>
    			<include name="org/ejbca/core/ejb/authorization/**/IAuthorizationSessionLocal.java"/>
    			<include name="org/ejbca/core/ejb/authorization/**/IAuthorizationSessionLocalHome.java"/>
    		</fileset>
    		<fileset dir="${src.dir}">
    			<include name="org/ejbca/core/ejb/authorization/**/*.java"/>
    			<include name="org/ejbca/core/model/authorization/**/*.java"/>
    		</fileset>
    	</copy>
        <javac srcdir="${src-temp.dir}/authorization" destdir="${build-temp.dir}/authorization" debug="on" includeantruntime="no"
        	encoding="iso8859-1" target="${java.target.version}">
        	<classpath>
        		<path refid="compile.classpath"/>
        		<pathelement location="${build-temp.dir}/common"/>
        		<pathelement location="${build-temp.dir}/protect"/>
        		<pathelement location="${build-temp.dir}/admins"/>
        		<pathelement location="${build-temp.dir}/logging"/>
        	</classpath>
        </javac>
    	<!-- Notification component -->
    	<echo message=" ** Validating component: Notification Base 	**"/>
    	<mkdir dir="${src-temp.dir}/notification"/>
    	<mkdir dir="${build-temp.dir}/notification"/>
    	<copy todir="${src-temp.dir}/notification">
    		<fileset dir="${src.dir}">
    			<!-- Include the Mail utility and configuration as a subcomponent of Notification -->
    			<include name="org/ejbca/config/MailConfiguration.java"/>
    			<include name="org/ejbca/util/mail/*.java"/>
    			<!-- Include the notification base components -->
				<include name="org/ejbca/util/NotificationParamGen.java"/>
    		</fileset>
    	</copy>
        <javac srcdir="${src-temp.dir}/notification" destdir="${build-temp.dir}/notification" debug="on" includeantruntime="no"
        	encoding="iso8859-1" target="${java.target.version}">
        	<classpath>
        		<path refid="compile.classpath"/>
        		<pathelement location="${build-temp.dir}/common"/>
        		<pathelement location="${build-temp.dir}/protect"/>
        		<pathelement location="${build-temp.dir}/admins"/>
        		<pathelement location="${build-temp.dir}/logging"/>
        	</classpath>
        </javac>
    	<!-- Approval component -->
    	<echo message=" ** Validating component: Approval Base (still includes GlobalConfiguration..) **"/>
    	<mkdir dir="${src-temp.dir}/approval"/>
    	<mkdir dir="${build-temp.dir}/approval"/>
    	<copy todir="${src-temp.dir}/approval">
    		<fileset dir="${ejbca.home}/tmp/bin/gensrc">
    			<include name="org/ejbca/core/ejb/approval/ApprovalDataLocalHome.java"/>
    			<include name="org/ejbca/core/ejb/approval/ApprovalDataLocal.java"/>
    			<include name="org/ejbca/core/ejb/approval/IApprovalSessionLocal.java"/>
    			<include name="org/ejbca/core/ejb/approval/IApprovalSessionLocalHome.java"/>
    		</fileset>
    		<fileset dir="${src.dir}">
    			<include name="org/ejbca/core/ejb/approval/**/*.java"/>
    			<include name="org/ejbca/core/model/approval/**/*.java"/>
    	    	<!-- GlobalConfiguration is more of RA/AdminGUI component, but is hard to get rid of w/o database changes.. -->
    			<include name="org/ejbca/core/model/ra/raadmin/GlobalConfiguration.java"/>
    			<include name="org/ejbca/config/InternalConfiguration.java"/>
    			<include name="org/ejbca/config/WebConfiguration.java"/>
    	    	<!-- RA approval requests -->
    			<exclude name="org/ejbca/core/model/approval/approvalrequests/EditEndEntityApprovalRequest.java"/>
    			<exclude name="org/ejbca/core/model/approval/approvalrequests/AddEndEntityApprovalRequest.java"/>
    			<exclude name="org/ejbca/core/model/approval/ApprovalRequestHelper.java"/>
    			<exclude name="org/ejbca/core/model/approval/approvalrequests/ChangeStatusEndEntityApprovalRequest.java"/>
    			<exclude name="org/ejbca/core/model/approval/approvalrequests/RevocationApprovalRequest.java"/>
    	    	<!-- CA approval requests -->
    			<exclude name="org/ejbca/core/model/approval/approvalrequests/ActivateCATokenApprovalRequest.java"/>
    	    	<!-- Key Recovery approval requests -->
    			<exclude name="org/ejbca/core/model/approval/approvalrequests/KeyRecoveryApprovalRequest.java"/>
    		</fileset>
    	</copy>
        <javac srcdir="${src-temp.dir}/approval" destdir="${build-temp.dir}/approval" debug="on" includeantruntime="no"
        	encoding="iso8859-1" target="${java.target.version}">
        	<classpath>
        		<path refid="compile.classpath"/>
        		<pathelement location="${build-temp.dir}/common"/>
        		<pathelement location="${build-temp.dir}/admins"/>
        		<pathelement location="${build-temp.dir}/logging"/>
        		<pathelement location="${build-temp.dir}/authorization"/>
        		<pathelement location="${build-temp.dir}/notification"/>
        	</classpath>
        </javac>
    	<!-- Publish component -->
    	<echo message=" ** Validating component: Publish **"/>
    	<mkdir dir="${src-temp.dir}/publish"/>
    	<mkdir dir="${build-temp.dir}/publish"/>
    	<copy todir="${src-temp.dir}/publish">
    		<fileset dir="${ejbca.home}/tmp/bin/gensrc">
    			<include name="org/ejbca/core/ejb/ca/publisher/*DataLocalHome.java"/>
    			<include name="org/ejbca/core/ejb/ca/publisher/*DataLocal.java"/>
    			<include name="org/ejbca/core/ejb/ca/publisher/*DataPK.java"/>
    			<include name="org/ejbca/core/ejb/ca/publisher/*Local.java"/>
    			<include name="org/ejbca/core/ejb/ca/publisher/*LocalHome.java"/>
    		</fileset>
    		<fileset dir="${src.dir}">
    			<include name="org/ejbca/core/ejb/ca/publisher/**/*.java"/>
    			<include name="org/ejbca/core/model/ca/publisher/**/*.java"/>
    			<!-- Use by the LDAP Publisher -->
    			<include name="org/ejbca/util/TCPTool.java"/>
    			<!-- Use by the OCSP Publisher -->
    			<include name="org/ejbca/core/model/ca/store/CertificateInfo.java"/>
    	    	<!-- SecConst should proabaly be devided into several constants classes.. -->
    			<include name="org/ejbca/core/model/SecConst.java"/>
    			<!-- RA classes that maybe shouldn't be here.. -->
    			<include name="org/ejbca/core/model/ra/ExtendedInformation.java"/>
    			<include name="org/ejbca/core/model/ra/UserDataVO.java"/>
    		</fileset>
    	</copy>
        <javac srcdir="${src-temp.dir}/publish" destdir="${build-temp.dir}/publish" debug="on" includeantruntime="no"
        	encoding="iso8859-1" target="${java.target.version}">
        	<classpath>
        		<path refid="compile.classpath"/>
        		<pathelement location="${build-temp.dir}/common"/>
        		<pathelement location="${build-temp.dir}/protect"/>
        		<pathelement location="${build-temp.dir}/admins"/>
        		<pathelement location="${build-temp.dir}/logging"/>
        		<pathelement location="${build-temp.dir}/authorization"/>
        	</classpath>
        </javac>
    	<!-- Certificate History component -->
    	<echo message=" ** Validating component: Certificate History **"/>
    	<mkdir dir="${src-temp.dir}/certhist"/>
    	<mkdir dir="${build-temp.dir}/certhist"/>
    	<copy todir="${src-temp.dir}/certhist">
    		<fileset dir="${ejbca.home}/tmp/bin/gensrc">
    			<include name="org/ejbca/core/ejb/ca/store/CertReqHistoryDataLocalHome.java"/>
    			<include name="org/ejbca/core/ejb/ca/store/CertReqHistoryDataLocal.java"/>
    			<include name="org/ejbca/core/ejb/ca/store/CertReqHistoryDataPK.java"/>
    		</fileset>
    		<fileset dir="${src.dir}">
    			<include name="org/ejbca/core/ejb/ca/store/CertReqHistory*.java"/>
    			<include name="org/ejbca/core/model/ca/store/CertReqHistory*.java"/>
    	    	<!-- SecConst should proabaly be devided into several constants classes.. -->
    			<include name="org/ejbca/core/model/SecConst.java"/>
    			<!-- RA classes that maybe shouldn't be here.. -->
    			<include name="org/ejbca/core/model/ra/ExtendedInformation.java"/>
    			<include name="org/ejbca/core/model/ra/UserDataVO.java"/>
    		</fileset>
    	</copy>
        <javac srcdir="${src-temp.dir}/certhist" destdir="${build-temp.dir}/certhist" debug="on" includeantruntime="no"
        	encoding="iso8859-1" target="${java.target.version}">
        	<classpath>
        		<path refid="compile.classpath"/>
        		<pathelement location="${build-temp.dir}/common"/>
        		<pathelement location="${build-temp.dir}/admins"/>
        		<pathelement location="${build-temp.dir}/logging"/>
        	</classpath>
        </javac>
    	<!-- Certificate Profile component -->
    	<echo message=" ** Validating component: Certificate Profile **"/>
    	<mkdir dir="${src-temp.dir}/certprof"/>
    	<mkdir dir="${build-temp.dir}/certprof"/>
    	<copy todir="${src-temp.dir}/certprof">
    		<fileset dir="${ejbca.home}/tmp/bin/gensrc">
    			<include name="org/ejbca/core/ejb/ca/certificateprofiles/*DataLocalHome.java"/>
    			<include name="org/ejbca/core/ejb/ca/certificateprofiles/*DataLocal.java"/>
    			<include name="org/ejbca/core/ejb/ca/certificateprofiles/*DataPK.java"/>
    		</fileset>
    		<fileset dir="${src.dir}">
    			<include name="org/ejbca/core/ejb/ca/certificateprofiles/*.java"/>
    			<include name="org/ejbca/core/model/ca/certificateprofiles/*.java"/>
    			<include name="org/ejbca/config/ExtendedKeyUsageConfiguration.java"/>
    	    	<!-- SecConst should proabaly be devided into several constants classes.. -->
    			<include name="org/ejbca/core/model/SecConst.java"/>
    		</fileset>
    	</copy>
        <javac srcdir="${src-temp.dir}/certprof" destdir="${build-temp.dir}/certprof" debug="on" includeantruntime="no"
        	encoding="iso8859-1" target="${java.target.version}">
        	<classpath>
        		<path refid="compile.classpath"/>
        		<pathelement location="${build-temp.dir}/common"/>
        		<pathelement location="${build-temp.dir}/admins"/>
        		<pathelement location="${build-temp.dir}/logging"/>
        	</classpath>
        </javac>
    	<!-- Certificate Storage component -->
    	<echo message=" ** Validating component: Certificate Storage **"/>
    	<mkdir dir="${src-temp.dir}/certstore"/>
    	<mkdir dir="${build-temp.dir}/certstore"/>
    	<copy todir="${src-temp.dir}/certstore">
    		<fileset dir="${ejbca.home}/tmp/bin/gensrc">
    			<include name="org/ejbca/core/ejb/ca/store/*DataLocalHome.java"/>
    			<include name="org/ejbca/core/ejb/ca/store/*DataLocal.java"/>
    			<include name="org/ejbca/core/ejb/ca/store/*LocalHome.java"/>
    			<include name="org/ejbca/core/ejb/ca/store/*Local.java"/>
    			<include name="org/ejbca/core/ejb/ca/store/*Home.java"/>
    			<include name="org/ejbca/core/ejb/ca/store/*Remote.java"/>
    			<include name="org/ejbca/core/ejb/ca/store/*DataPK.java"/>
    			<exclude name="org/ejbca/core/ejb/ca/store/CertReqHistory*.java"/>
    			<exclude name="org/ejbca/core/model/ca/store/CertReqHistory*.java"/>
    		</fileset>
    		<fileset dir="${src.dir}">
    			<include name="org/ejbca/core/ejb/ca/store/**/*.java"/>
    			<include name="org/ejbca/core/model/ca/store/**/*.java"/>
    			<exclude name="org/ejbca/core/ejb/ca/store/CertReqHistoryDataLocalHome.java"/>
    			<exclude name="org/ejbca/core/ejb/ca/store/CertReqHistoryDataLocal.java"/>
    			<exclude name="org/ejbca/core/ejb/ca/store/CertReqHistoryDataPK.java"/>
    		</fileset>
    	</copy>
        <javac srcdir="${src-temp.dir}/certstore" destdir="${build-temp.dir}/certstore" debug="on" includeantruntime="no"
        	encoding="iso8859-1" target="${java.target.version}">
        	<classpath>
        		<path refid="compile.classpath"/>
        		<pathelement location="${build-temp.dir}/common"/>
        		<pathelement location="${build-temp.dir}/protect"/>
        		<pathelement location="${build-temp.dir}/admins"/>
        		<pathelement location="${build-temp.dir}/logging"/>
        		<pathelement location="${build-temp.dir}/authorization"/>
        		<pathelement location="${build-temp.dir}/notification"/>
        		<pathelement location="${build-temp.dir}/publish"/>
        		<pathelement location="${build-temp.dir}/certhist"/>
        		<pathelement location="${build-temp.dir}/certprof"/>
        	</classpath>
        </javac>
    	<!-- CA Token component -->
    	<echo message=" ** Validating component: CA Token **"/>
    	<mkdir dir="${src-temp.dir}/catoken"/>
    	<mkdir dir="${build-temp.dir}/catoken"/>
    	<copy todir="${src-temp.dir}/catoken">
    		<fileset dir="${src.dir}">
    			<include name="org/ejbca/core/model/ca/catoken/*.java"/>
    			<include name="org/ejbca/core/model/util/AlgorithmTools.java"/>
    			<include name="org/ejbca/util/keystore/*.java"/>
    			<include name="org/ejbca/util/CMS.java"/>
    			<include name="org/ejbca/ui/cli/ErrorAdminCommandException.java"/>
    			<include name="org/ejbca/ui/cli/util/ConsolePasswordReader.java"/>
    			<include name="org/ejbca/ui/cli/util/PasswordReader.java"/>
    			<include name="org/ejbca/core/model/ca/caadmin/IllegalKeyStoreException.java"/>
    			<!-- CertTools -->
    			<include name="org/ejbca/util/CertTools.java"/>
    			<include name="org/ejbca/core/model/ca/crl/RevokedCertInfo.java"/>
    			<include name="org/ejbca/util/dn/DnComponents.java"/>
    		</fileset>
    	</copy>
        <javac srcdir="${src-temp.dir}/catoken" destdir="${build-temp.dir}/catoken" debug="on" includeantruntime="no"
        	encoding="iso8859-1" target="${java.target.version}">
        	<classpath>
        		<path refid="compile.classpath"/>
        		<pathelement location="${build-temp.dir}/common"/>
        		<pathelement location="${build-temp.dir}/certprof"/>
        	</classpath>
        </javac>
    	<!-- CA and Certificate Extensions component -->
    	<echo message=" ** Validating component: CA and Certificate Extensions **"/>
    	<mkdir dir="${src-temp.dir}/ca"/>
    	<mkdir dir="${build-temp.dir}/ca"/>
    	<copy todir="${src-temp.dir}/ca">
    		<fileset dir="${src.dir}">
    			<include name="org/ejbca/core/model/ca/caadmin/CA.java"/>
    			<include name="org/ejbca/core/model/ca/caadmin/CVCCA.java"/>
    			<include name="org/ejbca/core/model/ca/caadmin/X509CA.java"/>
    			<include name="org/ejbca/core/model/ca/caadmin/CAInfo.java"/>
    			<include name="org/ejbca/core/model/ca/caadmin/X509CAInfo.java"/>
    			<include name="org/ejbca/core/model/ca/caadmin/CVCCAInfo.java"/>
    			<include name="org/ejbca/core/model/ca/caadmin/extendedcaservices/*.java"/>
    			<include name="org/ejbca/core/model/ca/caadmin/CertificateValidity.java"/>
    			<include name="org/ejbca/core/model/ca/caadmin/IllegalValidityException.java"/>
    			<include name="org/ejbca/core/model/ca/CAOfflineException.java"/>
    			<include name="org/ejbca/core/model/ca/SignRequestSignatureException.java"/>
    			<include name="org/ejbca/core/model/ca/SignRequestException.java"/>
    			<include name="org/ejbca/core/ejb/ca/sign/SernoGenerator.java"/>
    			<include name="org/ejbca/core/ejb/ca/sign/ISernoGenerator.java"/>
    			<include name="org/ejbca/util/ValidityDate.java"/>
    			<include name="org/ejbca/util/SimpleTime.java"/>
    			<include name="org/ejbca/util/UnitParser.java"/>
    			<include name="org/ejbca/util/YearMonthDayTime.java"/>
    			<include name="org/ejbca/util/RequestMessageUtils.java"/>
    			<include name="org/ejbca/util/cert/PrintableStringEntryConverter.java"/>
    			<include name="org/ejbca/core/model/ra/NotFoundException.java"/>
    			<include name="org/ejbca/core/protocol/PKCS10RequestMessage.java"/>
    			<include name="org/ejbca/core/protocol/CVCRequestMessage.java"/>
    			<include name="org/ejbca/core/protocol/IRequestMessage.java"/>
    			<include name="org/ejbca/core/protocol/IResponseMessage.java"/>
    			<include name="org/ejbca/core/protocol/ResponseStatus.java"/>
    			<include name="org/ejbca/core/protocol/FailInfo.java"/>
    			<!-- Dependency on Certificate Extensions -->
    			<include name="org/ejbca/util/cert/SubjectDirAttrExtension.java"/>
    			<include name="org/ejbca/core/model/ca/certextensions/standard/*.java"/>
    			<include name="org/ejbca/core/model/ca/certextensions/*.java"/>
    			<!-- OCSPCAService dependencies that maybe shouldn't be here.. -->
    			<include name="org/ejbca/config/OcspConfiguration.java"/>
    			<include name="org/ejbca/core/protocol/ocsp/OCSPUtil.java"/>
    			<include name="org/ejbca/core/protocol/ocsp/OCSPResponseItem.java"/>
    			<include name="org/ejbca/core/protocol/ocsp/CertificateCache.java"/>
    			<include name="org/ejbca/core/model/ca/NotSupportedException.java"/>
    			<!-- RA classes that maybe shouldn't be here.. -->
    			<include name="org/ejbca/core/model/ra/ExtendedInformation.java"/>
    			<include name="org/ejbca/core/model/ra/UserDataVO.java"/>
    		</fileset>
    	</copy>
        <javac srcdir="${src-temp.dir}/ca" destdir="${build-temp.dir}/ca" debug="on" includeantruntime="no"
        	encoding="iso8859-1" target="${java.target.version}">
        	<classpath>
        		<path refid="compile.classpath"/>
        		<pathelement location="${build-temp.dir}/common"/>
        		<pathelement location="${build-temp.dir}/certprof"/>
        		<pathelement location="${build-temp.dir}/catoken"/>
        		<pathelement location="${build-temp.dir}/admins"/>
        	</classpath>
        </javac>
    	<!-- Signing component -->
    	<echo message=" ** Validating component: Signing **"/>
    	<mkdir dir="${src-temp.dir}/signing"/>
    	<mkdir dir="${build-temp.dir}/signing"/>
    	<copy todir="${src-temp.dir}/signing">
    		<fileset dir="${ejbca.home}/tmp/bin/gensrc">
    			<include name="org/ejbca/core/ejb/ca/sign/*LocalHome.java"/>
    			<include name="org/ejbca/core/ejb/ca/sign/*Local.java"/>
    			<include name="org/ejbca/core/ejb/ca/sign/*Home.java"/>
    			<include name="org/ejbca/core/ejb/ca/sign/*Remote.java"/>
    			<include name="org/ejbca/core/ejb/ca/sign/*DataPK.java"/>
    			<!-- CA Admin dependency (not ideal, but ok for now..)-->
    			<include name="org/ejbca/core/ejb/ca/caadmin/ICAAdminSessionLocal.java"/>
    			<include name="org/ejbca/core/ejb/ca/caadmin/ICAAdminSessionLocalHome.java"/>
    			<!-- Authentication dependency (unwanted.. depends on RA..) -->
    			<include name="org/ejbca/core/ejb/ca/auth/IAuthenticationSessionLocal.java"/>
    			<include name="org/ejbca/core/ejb/ca/auth/IAuthenticationSessionLocalHome.java"/>
    			<!-- CRL dependency (unwanted.. depends on CRL..) -->
    			<include name="org/ejbca/core/ejb/ca/crl/ICreateCRLSessionLocal.java"/>
    			<include name="org/ejbca/core/ejb/ca/crl/ICreateCRLSessionLocalHome.java"/>
    		</fileset>
    		<fileset dir="${src.dir}">
    			<include name="org/ejbca/core/ejb/ca/sign/**/*.java"/>
    			<include name="org/ejbca/core/model/ca/sign/**/*.java"/>
    			<include name="org/ejbca/core/model/ca/IllegalKeyException.java"/>
    			<include name="org/ejbca/core/model/ca/caadmin/CADoesntExistsException.java"/>
    			<!-- CA Admin dependency (not ideal, but ok for now..)-->
    			<include name="org/ejbca/core/model/ca/caadmin/CAExistsException.java"/>
    			<!-- Authentication dependency (unwanted.. depends on RA..) -->
    			<include name="org/ejbca/core/model/ca/AuthStatusException.java"/>
    			<include name="org/ejbca/core/model/ca/AuthLoginException.java"/>
    		</fileset>
    	</copy>
        <javac srcdir="${src-temp.dir}/signing" destdir="${build-temp.dir}/signing" debug="on" includeantruntime="no"
        	encoding="iso8859-1" target="${java.target.version}">
        	<classpath>
        		<path refid="compile.classpath"/>
        		<pathelement location="${build-temp.dir}/common"/>
        		<pathelement location="${build-temp.dir}/protect"/>
        		<pathelement location="${build-temp.dir}/admins"/>
        		<pathelement location="${build-temp.dir}/logging"/>
        		<pathelement location="${build-temp.dir}/authorization"/>
        		<pathelement location="${build-temp.dir}/notification"/>
        		<pathelement location="${build-temp.dir}/approval"/>
        		<pathelement location="${build-temp.dir}/publish"/>
        		<pathelement location="${build-temp.dir}/certprof"/>
        		<pathelement location="${build-temp.dir}/certstore"/>
        		<pathelement location="${build-temp.dir}/catoken"/>
        		<pathelement location="${build-temp.dir}/ca"/>
        	</classpath>
        </javac>
    	<!-- OCSP component -->
    	<echo message=" ** Validating component: OCSP **"/>
    	<mkdir dir="${src-temp.dir}/ocsp"/>
    	<mkdir dir="${build-temp.dir}/ocsp"/>
    	<copy todir="${src-temp.dir}/ocsp">
    		<fileset dir="${src.dir}">
    			<include name="org/ejbca/config/OcspConfiguration.java"/>
    			<include name="org/ejbca/util/IPatternLogger.java"/>
    			<include name="org/ejbca/util/PatternLogger.java"/>
    			<include name="org/ejbca/core/protocol/ocsp/*.java"/>
    			<include name="org/ejbca/core/model/util/AlgorithmTools.java"/>
    			<include name="org/ejbca/util/keystore/KeyTools.java"/>
    		</fileset>
    	</copy>
        <javac srcdir="${src-temp.dir}/ocsp" destdir="${build-temp.dir}/ocsp" debug="on" includeantruntime="no"
        	encoding="iso8859-1" target="${java.target.version}">
        	<classpath>
        		<path refid="compile.classpath"/>
        		<pathelement location="${build-temp.dir}/common"/>
        		<pathelement location="${build-temp.dir}/admins"/>
        		<pathelement location="${build-temp.dir}/certstore"/>
        		<pathelement location="${build-temp.dir}/ca"/>
        	</classpath>
        </javac>
    	<!-- CRL component -->
    	<echo message=" ** Validating component: CRL **"/>
    	<mkdir dir="${src-temp.dir}/crl"/>
    	<mkdir dir="${build-temp.dir}/crl"/>
    	<copy todir="${src-temp.dir}/crl">
    		<fileset dir="${ejbca.home}/tmp/bin/gensrc">
    			<include name="org/ejbca/core/ejb/ca/store/CRLDataLocalHome.java"/>
    			<include name="org/ejbca/core/ejb/ca/store/CRLDataLocal.java"/>
    			<include name="org/ejbca/core/ejb/ca/store/CRLDataPK.java"/>
    			<!-- Undesired dependency on CAAdministraion ? -->
    			<include name="org/ejbca/core/ejb/ca/caadmin/ICAAdminSessionLocalHome.java"/>
    			<include name="org/ejbca/core/ejb/ca/caadmin/ICAAdminSessionLocal.java"/>
    		</fileset>
    		<fileset dir="${src.dir}">
    			<include name="org/ejbca/core/ejb/ca/crl/*.java"/>
    			<include name="org/ejbca/core/model/ca/crl/*.java"/>
    		</fileset>
    	</copy>
        <javac srcdir="${src-temp.dir}/crl" destdir="${build-temp.dir}/crl" debug="on" includeantruntime="no"
        	encoding="iso8859-1" target="${java.target.version}">
        	<classpath>
        		<path refid="compile.classpath"/>
        		<pathelement location="${build-temp.dir}/common"/>
        		<pathelement location="${build-temp.dir}/admins"/>
        		<pathelement location="${build-temp.dir}/ca"/>
        		<pathelement location="${build-temp.dir}/signing"/>
        		<pathelement location="${build-temp.dir}/logging"/>
        		<pathelement location="${build-temp.dir}/authorization"/>
        		<pathelement location="${build-temp.dir}/catoken"/>
        		<pathelement location="${build-temp.dir}/certstore"/>
        		<pathelement location="${build-temp.dir}/approval"/>
        	</classpath>
        </javac>
    	<!-- CA Admin component -->
    	<echo message=" ** Validating component: CA Admin **"/>
    	<mkdir dir="${src-temp.dir}/caadmin"/>
    	<mkdir dir="${build-temp.dir}/caadmin"/>
    	<copy todir="${src-temp.dir}/caadmin">
    		<fileset dir="${ejbca.home}/tmp/bin/gensrc">
    			<include name="org/ejbca/core/ejb/ca/caadmin/*Home.java"/>
    			<include name="org/ejbca/core/ejb/ca/caadmin/*Local.java"/>
    			<include name="org/ejbca/core/ejb/ca/caadmin/*Remote.java"/>
    			<include name="org/ejbca/core/ejb/ca/caadmin/*DataPK.java"/>
    		</fileset>
    		<fileset dir="${src.dir}">
    			<include name="org/ejbca/core/ejb/ca/caadmin/*.java"/>
    			<include name="org/ejbca/core/model/ca/caadmin/*.java"/>
    			<include name="org/ejbca/core/model/approval/approvalrequests/ActivateCATokenApprovalRequest.java"/>
    			<include name="org/ejbca/core/protocol/ocsp/CertificateCacheInternal.java"/>
    			<include name="org/ejbca/core/protocol/X509ResponseMessage.java"/>
    		</fileset>
    	</copy>
        <javac srcdir="${src-temp.dir}/caadmin" destdir="${build-temp.dir}/caadmin" debug="on" includeantruntime="no"
        	encoding="iso8859-1" target="${java.target.version}">
        	<classpath>
        		<path refid="compile.classpath"/>
        		<pathelement location="${build-temp.dir}/common"/>
        		<pathelement location="${build-temp.dir}/admins"/>
        		<pathelement location="${build-temp.dir}/ca"/>
        		<pathelement location="${build-temp.dir}/signing"/>
        		<pathelement location="${build-temp.dir}/logging"/>
        		<pathelement location="${build-temp.dir}/authorization"/>
        		<pathelement location="${build-temp.dir}/catoken"/>
        		<pathelement location="${build-temp.dir}/certstore"/>
        		<pathelement location="${build-temp.dir}/certprof"/>
        		<pathelement location="${build-temp.dir}/approval"/>
        		<pathelement location="${build-temp.dir}/crl"/>
        		<pathelement location="${build-temp.dir}/publish"/>
        	</classpath>
        </javac>
    	<!-- User Data Source component... -->
    	<echo message=" ** Validating component: User Data Source **"/>
    	<mkdir dir="${src-temp.dir}/userdatasource"/>
    	<mkdir dir="${build-temp.dir}/userdatasource"/>
    	<copy todir="${src-temp.dir}/userdatasource">
    		<fileset dir="${ejbca.home}/tmp/bin/gensrc">
    			<include name="org/ejbca/core/ejb/ra/userdatasource/UserDataSourceDataLocalHome.java"/>
    			<include name="org/ejbca/core/ejb/ra/userdatasource/UserDataSourceDataLocal.java"/>
    		</fileset>
    		<fileset dir="${src.dir}">
    			<include name="org/ejbca/core/ejb/ra/userdatasource/**/*.java"/>
    			<include name="org/ejbca/core/model/ra/userdatasource/**/*.java"/>
    		</fileset>
    	</copy>
        <javac srcdir="${src-temp.dir}/userdatasource" destdir="${build-temp.dir}/userdatasource" debug="on" includeantruntime="no"
        	encoding="iso8859-1" target="${java.target.version}">
        	<classpath>
        		<path refid="compile.classpath"/>
        		<pathelement location="${build-temp.dir}/common"/>
        		<pathelement location="${build-temp.dir}/ca"/>
        		<pathelement location="${build-temp.dir}/admins"/>
        		<pathelement location="${build-temp.dir}/logging"/>
        		<pathelement location="${build-temp.dir}/authorization"/>
        		<pathelement location="${build-temp.dir}/caadmin"/>
        	</classpath>
        </javac>
    	<!-- Key Recovery component -->
    	<echo message=" ** Validating component: Key Recovery **"/>
    	<mkdir dir="${src-temp.dir}/keyrecovery"/>
    	<mkdir dir="${build-temp.dir}/keyrecovery"/>
    	<copy todir="${src-temp.dir}/keyrecovery">
    		<fileset dir="${ejbca.home}/tmp/bin/gensrc">
    			<include name="org/ejbca/core/ejb/keyrecovery/*LocalHome.java"/>
    			<include name="org/ejbca/core/ejb/keyrecovery/*Local.java"/>
    			<include name="org/ejbca/core/ejb/keyrecovery/*DataPK.java"/>
    			<!-- Undesired dependency on User Administration ? -->
    			<include name="org/ejbca/core/ejb/ra/IUserAdminSessionLocalHome.java"/>
    			<include name="org/ejbca/core/ejb/ra/IUserAdminSessionLocal.java"/>
    		</fileset>
    		<fileset dir="${src.dir}">
    			<include name="org/ejbca/core/ejb/keyrecovery/**/*.java"/>
    			<include name="org/ejbca/core/model/keyrecovery/**/*.java"/>
    			<include name="org/ejbca/core/model/approval/approvalrequests/KeyRecoveryApprovalRequest.java"/>
    			<!-- Undesired dependency on User Administration ? -->
    			<include name="org/ejbca/core/model/ra/raadmin/UserDoesntFullfillEndEntityProfile.java"/>
    			<include name="org/ejbca/core/model/ra/AlreadyRevokedException.java"/>
    		</fileset>
    	</copy>
        <javac srcdir="${src-temp.dir}/keyrecovery" destdir="${build-temp.dir}/keyrecovery" debug="on" includeantruntime="no"
        	encoding="iso8859-1" target="${java.target.version}">
        	<classpath>
        		<path refid="compile.classpath"/>
        		<pathelement location="${build-temp.dir}/common"/>
        		<pathelement location="${build-temp.dir}/caadmin"/>
        		<pathelement location="${build-temp.dir}/admins"/>
        		<pathelement location="${build-temp.dir}/logging"/>
        		<pathelement location="${build-temp.dir}/authorization"/>
        		<pathelement location="${build-temp.dir}/approval"/>
        		<pathelement location="${build-temp.dir}/ca"/>
        		<pathelement location="${build-temp.dir}/certstore"/>
        		<pathelement location="${build-temp.dir}/signing"/>
        	</classpath>
        </javac>
    	<!-- RA Administration component -->
    	<echo message=" ** Validating component: RA Administration **"/>
    	<mkdir dir="${src-temp.dir}/raadmin"/>
    	<mkdir dir="${build-temp.dir}/raadmin"/>
    	<copy todir="${src-temp.dir}/raadmin">
    		<fileset dir="${ejbca.home}/tmp/bin/gensrc">
    			<include name="org/ejbca/core/ejb/ra/raadmin/*LocalHome.java"/>
    			<include name="org/ejbca/core/ejb/ra/raadmin/*Local.java"/>
    			<include name="org/ejbca/core/ejb/ra/raadmin/*Home.java"/>
    			<include name="org/ejbca/core/ejb/ra/raadmin/*Remote.java"/>
    			<include name="org/ejbca/core/ejb/ra/raadmin/*DataPK.java"/>
    		</fileset>
    		<fileset dir="${src.dir}">
    			<include name="org/ejbca/core/ejb/ra/raadmin/**/*.java"/>
    			<include name="org/ejbca/core/model/ra/raadmin/**/*.java"/>
    			<include name="org/ejbca/util/passgen/*.java"/>
    			<include name="org/ejbca/core/model/ra/UserDataConstants.java"/>
    		</fileset>
    	</copy>
        <javac srcdir="${src-temp.dir}/raadmin" destdir="${build-temp.dir}/raadmin" debug="on" includeantruntime="no"
        	encoding="iso8859-1" target="${java.target.version}">
        	<classpath>
        		<path refid="compile.classpath"/>
        		<pathelement location="${build-temp.dir}/common"/>
        		<pathelement location="${build-temp.dir}/caadmin"/>
        		<pathelement location="${build-temp.dir}/admins"/>
        		<pathelement location="${build-temp.dir}/logging"/>
        		<pathelement location="${build-temp.dir}/authorization"/>
        		<pathelement location="${build-temp.dir}/approval"/>
        		<pathelement location="${build-temp.dir}/ca"/>
        		<pathelement location="${build-temp.dir}/certstore"/>
        		<pathelement location="${build-temp.dir}/signing"/>
        	</classpath>
        </javac>
    	<!-- Hard Token component -->
    	<echo message=" ** Validating component: Hard Token **"/>
    	<mkdir dir="${src-temp.dir}/hardtoken"/>
    	<mkdir dir="${build-temp.dir}/hardtoken"/>
    	<copy todir="${src-temp.dir}/hardtoken">
    		<fileset dir="${ejbca.home}/tmp/bin/gensrc">
    			<include name="org/ejbca/core/ejb/hardtoken/*LocalHome.java"/>
    			<include name="org/ejbca/core/ejb/hardtoken/*Local.java"/>
    			<include name="org/ejbca/core/ejb/hardtoken/*PK.java"/>
    			<include name="org/ejbca/core/ejb/hardtoken/*Remote.java"/>
    		</fileset>
    		<fileset dir="${src.dir}">
    			<include name="org/ejbca/core/ejb/hardtoken/**/*.java"/>
    			<include name="org/ejbca/core/model/hardtoken/**/*.java"/>
    			<include name="org/ejbca/core/model/ra/UserAdminConstants.java"/>
    			<include name="org/ejbca/core/model/ra/UserAdminConstants.java"/>
    		</fileset>
    	</copy>
        <javac srcdir="${src-temp.dir}/hardtoken" destdir="${build-temp.dir}/hardtoken" debug="on" includeantruntime="no"
        	encoding="iso8859-1" target="${java.target.version}">
        	<classpath>
        		<path refid="compile.classpath"/>
        		<pathelement location="${build-temp.dir}/common"/>
        		<pathelement location="${build-temp.dir}/caadmin"/>
        		<pathelement location="${build-temp.dir}/admins"/>
        		<pathelement location="${build-temp.dir}/logging"/>
        		<pathelement location="${build-temp.dir}/authorization"/>
        		<pathelement location="${build-temp.dir}/approval"/>
        		<pathelement location="${build-temp.dir}/ca"/>
        		<pathelement location="${build-temp.dir}/certstore"/>
        		<pathelement location="${build-temp.dir}/signing"/>
        		<pathelement location="${build-temp.dir}/raadmin"/>
        	</classpath>
        </javac>
    	<!-- CVS Log Exporter component -->
    	<echo message=" ** Validating component: CVS Log Exporter (single class, that is really a unwanted dependency from Logging) **"/>
    	<mkdir dir="${src-temp.dir}/csvlogexp"/>
    	<mkdir dir="${build-temp.dir}/csvlogexp"/>
    	<copy todir="${src-temp.dir}/csvlogexp">
    		<fileset dir="${src.dir}">
    			<include name="org/ejbca/core/model/log/CsvLogExporter.java"/>
    		</fileset>
    	</copy>
        <javac srcdir="${src-temp.dir}/csvlogexp" destdir="${build-temp.dir}/csvlogexp" debug="on" includeantruntime="no"
        	encoding="iso8859-1" target="${java.target.version}">
        	<classpath>
        		<path refid="compile.classpath"/>
        		<pathelement location="${build-temp.dir}/common"/>
        		<pathelement location="${build-temp.dir}/caadmin"/>
        		<pathelement location="${build-temp.dir}/signing"/>
        		<pathelement location="${build-temp.dir}/ca"/>
        		<pathelement location="${build-temp.dir}/logging"/>
        	</classpath>
        </javac>
    	<!-- Protected Log component -->
    	<echo message=" ** Validating component: Protected Log (deprecated unwanted dependency from Logging) **"/>
    	<mkdir dir="${src-temp.dir}/protlog"/>
    	<mkdir dir="${build-temp.dir}/protlog"/>
    	<copy todir="${src-temp.dir}/protlog">
    		<fileset dir="${ejbca.home}/tmp/bin/gensrc">
    			<include name="org/ejbca/core/ejb/log/**/ProtectedLog*.java"/>
    			<include name="org/ejbca/core/ejb/log/**/IProtectedLog*.java"/>
    			<!-- Unwanted dependency on Services (drags User Admin into it too..) -->
    			<include name="org/ejbca/core/ejb/services/IServiceSessionLocalHome.java"/>
    			<include name="org/ejbca/core/ejb/services/IServiceSessionLocal.java"/>
    			<include name="org/ejbca/core/ejb/ra/IUserAdminSessionLocalHome.java"/>
    			<include name="org/ejbca/core/ejb/ra/IUserAdminSessionLocal.java"/>
    		</fileset>
    		<fileset dir="${src.dir}">
    			<include name="org/ejbca/config/ProtectedLogConfiguration.java"/>
    			<include name="org/ejbca/core/ejb/log/**/ProtectedLog*.java"/>
    			<include name="org/ejbca/core/model/log/**/ProtectedLog*.java"/>
    			<include name="org/ejbca/core/model/log/**/IProtectedLog*.java"/>
    			<include name="org/ejbca/util/ManualUpdateCache.java"/>
    			<include name="org/ejbca/util/TCPTool.java"/>
    			<!-- Unwanted dependency on Services (drags User Admin into it too..) -->
    			<include name="org/ejbca/core/model/services/ServiceConfiguration.java"/>
    			<include name="org/ejbca/core/model/services/workers/ProtectedLogVerificationWorker.java"/>
    			<include name="org/ejbca/core/model/services/workers/ProtectedLogExportWorker.java"/>
    			<include name="org/ejbca/core/model/services/ServiceExistsException.java"/>
    			<include name="org/ejbca/core/model/services/ActionException.java"/>
    			<include name="org/ejbca/core/model/services/workers/EmailSendingWorkerConstants.java"/>
    			<include name="org/ejbca/core/model/services/actions/MailAction.java"/>
    			<include name="org/ejbca/core/model/services/actions/MailActionInfo.java"/>
    			<include name="org/ejbca/core/model/services/IWorker.java"/>
    			<include name="org/ejbca/core/model/services/IAction.java"/>
    			<include name="org/ejbca/core/model/services/IInterval.java"/>
    			<include name="org/ejbca/core/model/services/ActionInfo.java"/>
    			<include name="org/ejbca/core/model/services/BaseAction.java"/>
    			<include name="org/ejbca/core/model/services/BaseInterval.java"/>
    			<include name="org/ejbca/core/model/services/BaseWorker.java"/>
    			<include name="org/ejbca/core/model/services/ServiceExecutionFailedException.java"/>
    			<include name="org/ejbca/core/model/services/BaseServiceComponent.java"/>
    			<include name="org/ejbca/core/model/services/intervals/DummyInterval.java"/>
    			<include name="org/ejbca/core/model/ra/AlreadyRevokedException.java"/>
    			<include name="org/ejbca/core/model/ra/raadmin/UserDoesntFullfillEndEntityProfile.java"/>
    		</fileset>
    	</copy>
        <javac srcdir="${src-temp.dir}/protlog" destdir="${build-temp.dir}/protlog" debug="on" includeantruntime="no"
        	encoding="iso8859-1" target="${java.target.version}">
        	<classpath>
        		<path refid="compile.classpath"/>
        		<pathelement location="${build-temp.dir}/common"/>
        		<pathelement location="${build-temp.dir}/admins"/>
        		<pathelement location="${build-temp.dir}/caadmin"/>
        		<pathelement location="${build-temp.dir}/catoken"/>
        		<pathelement location="${build-temp.dir}/signing"/>
        		<pathelement location="${build-temp.dir}/ca"/>
        		<pathelement location="${build-temp.dir}/logging"/>
        		<pathelement location="${build-temp.dir}/certstore"/>
        		<pathelement location="${build-temp.dir}/protect"/>
        		<pathelement location="${build-temp.dir}/notification"/>
        		<pathelement location="${build-temp.dir}/authorization"/>
        		<pathelement location="${build-temp.dir}/approval"/>
        	</classpath>
        </javac>
    	<!-- User Administration and Authentication component -->
    	<!-- The authentication dependecy comes from the use of ApprovalExecutorUtil.. it might not be the best way to do this..
    		 The RA interface dependecy is from the way we present information about an approval. It should probably be parse
    		 general information better in the new Admin GUI for EJBCA 4.1. 
    	-->
    	<echo message=" ** Validating component: User Administration and Authentication **"/>
    	<mkdir dir="${src-temp.dir}/useradmin"/>
    	<mkdir dir="${build-temp.dir}/useradmin"/>
    	<copy todir="${src-temp.dir}/useradmin">
    		<fileset dir="${ejbca.home}/tmp/bin/gensrc">
    			<include name="org/ejbca/core/ejb/ra/*Home.java"/>
    			<include name="org/ejbca/core/ejb/ra/*Local.java"/>
    			<include name="org/ejbca/core/ejb/ra/*Remote.java"/>
    			<include name="org/ejbca/core/ejb/ra/*PK.java"/>
    			<!-- Undesired circular dependency on Authentication ? -->
    			<include name="org/ejbca/core/ejb/ca/auth/*.java"/>
    		</fileset>
    		<fileset dir="${src.dir}">
    			<include name="org/ejbca/core/ejb/ra/*.java"/>
    			<include name="org/ejbca/core/model/ra/*.java"/>
    			<include name="org/ejbca/core/model/approval/approvalrequests/EditEndEntityApprovalRequest.java"/>
    			<include name="org/ejbca/core/model/approval/approvalrequests/AddEndEntityApprovalRequest.java"/>
    			<include name="org/ejbca/core/model/approval/ApprovalRequestHelper.java"/>
    			<include name="org/ejbca/core/model/approval/approvalrequests/ChangeStatusEndEntityApprovalRequest.java"/>
    			<include name="org/ejbca/core/model/approval/approvalrequests/RevocationApprovalRequest.java"/>
    			<include name="org/ejbca/util/PrinterManager.java"/>
    			<include name="org/ejbca/util/dn/DistinguishedName.java"/>
    			<!-- Undesired dependency on RA Interface -->
    			<include name="org/ejbca/ui/web/admin/rainterface/RevokedInfoView.java"/>
    			<!-- Undesired circular dependency on Authentication ? -->
    			<include name="org/ejbca/core/ejb/ca/auth/*.java"/>
    			<include name="org/ejbca/core/model/ca/auth/*.java"/>
    		</fileset>
    	</copy>
        <javac srcdir="${src-temp.dir}/useradmin" destdir="${build-temp.dir}/useradmin" debug="on" includeantruntime="no"
        	encoding="iso8859-1" target="${java.target.version}">
        	<classpath>
        		<path refid="compile.classpath"/>
        		<pathelement location="${build-temp.dir}/common"/>
        		<pathelement location="${build-temp.dir}/caadmin"/>
        		<pathelement location="${build-temp.dir}/admins"/>
        		<pathelement location="${build-temp.dir}/logging"/>
        		<pathelement location="${build-temp.dir}/authorization"/>
        		<pathelement location="${build-temp.dir}/approval"/>
        		<pathelement location="${build-temp.dir}/ca"/>
        		<pathelement location="${build-temp.dir}/certstore"/>
        		<pathelement location="${build-temp.dir}/certprof"/>
        		<pathelement location="${build-temp.dir}/signing"/>
        		<pathelement location="${build-temp.dir}/raadmin"/>
        		<pathelement location="${build-temp.dir}/keyrecovery"/>
        		<pathelement location="${build-temp.dir}/notification"/>
        		<pathelement location="${build-temp.dir}/hardtoken"/>
        	</classpath>
        </javac>
    	<!-- Services component -->
    	<echo message=" ** Validating component: Services **"/>
    	<mkdir dir="${src-temp.dir}/services"/>
    	<mkdir dir="${build-temp.dir}/services"/>
    	<copy todir="${src-temp.dir}/services">
    		<fileset dir="${ejbca.home}/tmp/bin/gensrc">
    			<include name="org/ejbca/core/ejb/services/*.java"/>
    		</fileset>
    		<fileset dir="${src.dir}">
    			<include name="org/ejbca/core/ejb/services/*.java"/>
    			<include name="org/ejbca/core/model/services/*.java"/>
    			<include name="org/ejbca/core/model/services/actions/*.java"/>
    			<include name="org/ejbca/core/model/services/intervals/*.java"/>
    			<include name="org/ejbca/core/model/services/workers/EmailSendingWorkerConstants.java"/>
    		</fileset>
    	</copy>
        <javac srcdir="${src-temp.dir}/services" destdir="${build-temp.dir}/services" debug="on" includeantruntime="no"
        	encoding="iso8859-1" target="${java.target.version}">
        	<classpath>
        		<path refid="compile.classpath"/>
        		<pathelement location="${build-temp.dir}/common"/>
        		<pathelement location="${build-temp.dir}/admins"/>
        		<pathelement location="${build-temp.dir}/logging"/>
        		<pathelement location="${build-temp.dir}/authorization"/>
        		<pathelement location="${build-temp.dir}/notification"/>
        		<pathelement location="${build-temp.dir}/crl"/>
        		<pathelement location="${build-temp.dir}/certstore"/>
        		<pathelement location="${build-temp.dir}/useradmin"/>
        	</classpath>
        </javac>
    	<!-- Upgrade component -->
    	<echo message=" ** Validating component: Upgrade **"/>
    	<mkdir dir="${src-temp.dir}/upgrade"/>
    	<mkdir dir="${build-temp.dir}/upgrade"/>
    	<copy todir="${src-temp.dir}/upgrade">
    		<fileset dir="${ejbca.home}/tmp/bin/gensrc">
    			<include name="org/ejbca/core/ejb/upgrade/*.java"/>
    		</fileset>
    		<fileset dir="${src.dir}">
    			<include name="org/ejbca/core/ejb/upgrade/*.java"/>
    			<include name="org/ejbca/util/SqlExecutor.java"/>
    		</fileset>
    	</copy>
        <javac srcdir="${src-temp.dir}/upgrade" destdir="${build-temp.dir}/upgrade" debug="on" includeantruntime="no"
        	encoding="iso8859-1" target="${java.target.version}">
        	<classpath>
        		<path refid="compile.classpath"/>
        		<pathelement location="${build-temp.dir}/common"/>
        		<pathelement location="${build-temp.dir}/admins"/>
        		<pathelement location="${build-temp.dir}/approval"/>
				<pathelement location="${build-temp.dir}/caadmin"/>
				<pathelement location="${build-temp.dir}/useradmin"/>
        		<pathelement location="${build-temp.dir}/authorization"/>
        		<pathelement location="${build-temp.dir}/certstore"/>
        		<!-- Since Upgrade depends on all other components we can add more here later without bother..
        		<pathelement location="${build-temp.dir}/..."/>
        		-->
        	</classpath>
        </javac>
    	<!-- CMP component -->
    	<echo message=" ** Validating component: CMP **"/>
    	<mkdir dir="${src-temp.dir}/cmp"/>
    	<mkdir dir="${build-temp.dir}/cmp"/>
    	<copy todir="${src-temp.dir}/cmp">
    		<fileset dir="${src.dir}">
    			<include name="org/ejbca/core/protocol/cmp/*.java"/>
    			<include name="org/ejbca/config/CmpConfiguration.java"/>
    			<include name="com/novosec/pkix/**/*.java"/>
    			<!-- Depends on quickserver lib.. not sure this inclusion is useful..
    			<include name="org/ejbca/ui/tcp/Cmp*.java"/>
    			-->
    		</fileset>
    	</copy>
        <javac srcdir="${src-temp.dir}/cmp" destdir="${build-temp.dir}/cmp" debug="on" includeantruntime="no"
        	encoding="iso8859-1" target="${java.target.version}">
        	<classpath>
        		<path refid="compile.classpath"/>
        		<pathelement location="${build-temp.dir}/common"/>
				<pathelement location="${build-temp.dir}/ca"/>
				<pathelement location="${build-temp.dir}/caadmin"/>
				<pathelement location="${build-temp.dir}/raadmin"/>
				<pathelement location="${build-temp.dir}/useradmin"/>
        		<pathelement location="${build-temp.dir}/signing"/>
        		<pathelement location="${build-temp.dir}/admins"/>
        		<pathelement location="${build-temp.dir}/approval"/>
        		<pathelement location="${build-temp.dir}/certstore"/>
        		<pathelement location="${build-temp.dir}/authorization"/>
        	</classpath>
        </javac>
    	<!-- SCEP Base component -->
    	<echo message=" ** Validating component: SCEP Base **"/>
    	<mkdir dir="${src-temp.dir}/scep"/>
    	<mkdir dir="${build-temp.dir}/scep"/>
    	<copy todir="${src-temp.dir}/scep">
    		<fileset dir="${src.dir}">
    			<include name="org/ejbca/core/protocol/scep/*.java"/>
    			<include name="org/ejbca/ui/web/protocol/Scep*.java"/>
    			<!-- Servlet dependency -->
    			<include name="org/ejbca/ui/web/RequestHelper.java"/>
    			<include name="org/ejbca/ui/web/pub/ServletDebug.java"/>
    			<include name="org/ejbca/ui/web/pub/ServletUtils.java"/>
    			<include name="org/ejbca/config/WebConfiguration.java"/>
    		</fileset>
    	</copy>
        <javac srcdir="${src-temp.dir}/scep" destdir="${build-temp.dir}/scep" debug="on" includeantruntime="no"
        	encoding="iso8859-1" target="${java.target.version}">
        	<classpath>
        		<path refid="compile.classpath"/>
        		<pathelement location="${build-temp.dir}/common"/>
				<pathelement location="${build-temp.dir}/admins"/>
				<pathelement location="${build-temp.dir}/ca"/>
				<pathelement location="${build-temp.dir}/caadmin"/>
				<pathelement location="${build-temp.dir}/catoken"/>
				<pathelement location="${build-temp.dir}/signing"/>
				<pathelement location="${build-temp.dir}/authorization"/>
        	</classpath>
        </javac>
    </target>

    <target name="compile-util">
    	<mkdir dir="${build-util.dir}" />
        <javac srcdir="${src.dir}" destdir="${build-util.dir}" debug="on" includeantruntime="no"
        	encoding="iso8859-1" target="${java.target.version}">
        	<classpath>
        		<path refid="compile-util.classpath"/>
        	</classpath>
        	<!-- From EJBCA WS common lib -->
           	<include name="org/ejbca/core/model/SecConst.java"/>
        	<include name="org/ejbca/core/model/approval/ApprovalRequestExecutionException.java"/>
        	<include name="org/ejbca/core/model/approval/ApprovalRequestExpiredException.java"/>
           	<include name="org/ejbca/core/model/approval/WaitingForApprovalException.java"/>
           	<include name="org/ejbca/core/model/approval/ApprovalException.java"/>
           	<include name="org/ejbca/core/model/authorization/AuthorizationDeniedException.java"/>
           	<include name="org/ejbca/core/model/ca/SignRequestException.java"/>
           	<include name="org/ejbca/core/model/ca/caadmin/CADoesntExistsException.java"/>
           	<include name="org/ejbca/core/model/ca/publisher/PublisherException.java"/>
           	<include name="org/ejbca/core/model/hardtoken/HardTokenDoesntExistsException.java"/>
           	<include name="org/ejbca/core/model/hardtoken/HardTokenExistsException.java"/>
           	<include name="org/ejbca/core/model/ra/AlreadyRevokedException.java"/>
           	<include name="org/ejbca/core/model/ra/NotFoundException.java"/>
           	<include name="org/ejbca/core/model/ra/UserDataConstants.java"/>
           	<include name="org/ejbca/core/model/ra/raadmin/UserDoesntFullfillEndEntityProfile.java"/>
           	<include name="org/ejbca/core/model/ra/userdatasource/MultipleMatchException.java"/>
           	<include name="org/ejbca/core/model/ra/userdatasource/UserDataSourceException.java"/>
           	<include name="org/ejbca/core/model/hardtoken/HardTokenConstants.java"/>
        	<include name="org/ejbca/util/CertTools.java"/>
           	<include name="org/ejbca/util/query/IllegalQueryException.java"/>
           	<include name="org/ejbca/util/query/BasicMatch.java"/>
           	<include name="org/ejbca/util/query/UserMatch.java"/>
        	<!-- From EJBCA WS CLI (including some of the classes above) -->
           	<include name="org/ejbca/ui/cli/ErrorAdminCommandException.java"/>
           	<include name="org/ejbca/ui/cli/IAdminCommand.java"/>
           	<include name="org/ejbca/ui/cli/IllegalAdminCommandException.java"/>
           	<include name="org/ejbca/util/keystore/P11Slot.java"/>
           	<include name="org/ejbca/util/provider/TLSProvider.java"/>
           	<include name="org/ejbca/util/PerformanceTest.java"/>
           	<include name="org/ejbca/util/RequestMessageUtils.java"/>
        	<!-- From EJBCA XKMS CLI (including some of the classes above) -->
           	<include name="org/ejbca/util/keystore/P12toPEM.java"/>
        	<!-- From EJBCA EJB interfaces (including some of the classes above) -->
           	<include name="org/ejbca/core/model/log/Admin.java"/>
           	<include name="org/ejbca/core/model/approval/AdminAlreadyApprovedRequestException.java"/>
           	<include name="org/ejbca/core/model/approval/ApprovalDataVO.java"/>
           	<include name="org/ejbca/core/model/approval/Approval.java"/>
           	<include name="org/ejbca/util/query/Query.java"/>
           	<include name="org/ejbca/core/model/authorization/AdminGroup.java"/>
           	<include name="org/ejbca/core/model/authorization/AdminGroupExistsException.java"/>
           	<include name="org/ejbca/core/model/authorization/AuthenticationFailedException.java"/>
           	<include name="org/ejbca/core/model/ca/AuthStatusException.java"/>
           	<include name="org/ejbca/core/model/ca/AuthLoginException.java"/>
           	<include name="org/ejbca/core/model/ca/caadmin/CA.java"/>
           	<include name="org/ejbca/core/model/ca/caadmin/CAExistsException.java"/>
           	<include name="org/ejbca/core/model/ca/caadmin/CAInfo.java"/>
           	<include name="org/ejbca/core/model/ca/caadmin/IllegalKeyStoreException.java"/>
           	<include name="org/ejbca/core/model/ca/publisher/PublisherQueueVolatileData.java"/>
           	<include name="org/ejbca/core/model/ra/ExtendedInformation.java"/>
           	<include name="org/ejbca/core/model/ca/publisher/PublisherConnectionException.java"/>
           	<include name="org/ejbca/core/model/ca/publisher/BasePublisher.java"/>
           	<include name="org/ejbca/core/model/ca/publisher/PublisherExistsException.java"/>
           	<include name="org/ejbca/core/model/ca/IllegalKeyException.java"/>
           	<include name="org/ejbca/core/model/ca/SignRequestSignatureException.java"/>
           	<include name="org/ejbca/core/model/ca/caadmin/extendedcaservices/ExtendedCAServiceInfo.java"/>
           	<include name="org/ejbca/core/model/ca/caadmin/extendedcaservices/ExtendedCAServiceRequestException.java"/>
           	<include name="org/ejbca/core/model/ca/caadmin/extendedcaservices/IllegalExtendedCAServiceRequestException.java"/>
           	<include name="org/ejbca/core/model/ca/caadmin/extendedcaservices/ExtendedCAServiceNotActiveException.java"/>
           	<include name="org/ejbca/core/model/ca/caadmin/extendedcaservices/ExtendedCAServiceRequest.java"/>
           	<include name="org/ejbca/core/model/ca/caadmin/extendedcaservices/ExtendedCAServiceResponse.java"/>
           	<include name="org/ejbca/core/ejb/ca/store/CertificateStatus.java"/>
           	<include name="org/ejbca/core/model/ca/store/CertificateInfo.java"/>
           	<include name="org/ejbca/core/model/ca/store/CRLInfo.java"/>
           	<include name="org/ejbca/core/model/ca/store/CertReqHistory.java"/>
           	<include name="org/ejbca/core/model/ca/certificateprofiles/CertificateProfileExistsException.java"/>
           	<include name="org/ejbca/core/model/ca/certificateprofiles/CertificateProfile.java"/>
           	<include name="org/ejbca/core/model/hardtoken/UnavailableTokenException.java"/>
           	<include name="org/ejbca/core/model/hardtoken/profiles/HardTokenProfile.java"/>
           	<include name="org/ejbca/core/model/hardtoken/HardTokenProfileExistsException.java"/>
           	<include name="org/ejbca/core/model/hardtoken/HardTokenIssuer.java"/>
           	<include name="org/ejbca/core/model/hardtoken/HardTokenIssuerData.java"/>
           	<include name="org/ejbca/core/model/hardtoken/types/HardToken.java"/>
           	<include name="org/ejbca/core/model/hardtoken/HardTokenData.java"/>
           	<include name="org/ejbca/core/model/keyrecovery/KeyRecoveryData.java"/>
           	<include name="org/ejbca/core/model/log/ILogExporter.java"/>
           	<include name="org/ejbca/core/model/log/LogConfiguration.java"/>
           	<include name="org/ejbca/core/model/log/ILogDevice.java"/>
           	<include name="org/ejbca/core/model/log/IProtectedLogToken.java"/>
           	<include name="org/ejbca/core/model/log/ProtectedLogExportRow.java"/>
           	<include name="org/ejbca/core/model/log/ProtectedLogEventRow.java"/>
           	<include name="org/ejbca/core/model/log/ProtectedLogEventIdentifier.java"/>
           	<include name="org/ejbca/core/model/log/IProtectedLogExportHandler.java"/>
           	<include name="org/ejbca/core/model/protect/TableVerifyResult.java"/>
           	<include name="org/ejbca/core/model/ra/raadmin/AdminPreference.java"/>
           	<include name="org/ejbca/core/model/ra/raadmin/EndEntityProfile.java"/>
           	<include name="org/ejbca/core/model/ra/raadmin/EndEntityProfileExistsException.java"/>
           	<include name="org/ejbca/core/model/ra/userdatasource/BaseUserDataSource.java"/>
           	<include name="org/ejbca/core/model/ra/userdatasource/UserDataSourceExistsException.java"/>
           	<include name="org/ejbca/core/model/services/ServiceExistsException.java"/>
           	<include name="org/ejbca/core/model/services/ServiceConfiguration.java"/>
        	<!-- From EJBCA EJB CLI (including some of the classes above) -->
           	<include name="org/ejbca/core/ejb/ServiceLocator.java"/>
           	<include name="org/ejbca/core/protocol/X509ResponseMessage.java"/>
           	<include name="org/ejbca/util/PluginTool.java"/>
           	<include name="org/ejbca/util/PrinterManager.java"/>
           	<include name="org/ejbca/core/model/authorization/AccessRulesConstants.java"/>
           	<include name="org/ejbca/core/model/ra/UserAdminConstants.java"/>
           	<include name="org/ejbca/util/CliTools.java"/>
           	<include name="org/ejbca/core/model/ca/caadmin/X509CAInfo.java"/>
           	<include name="org/ejbca/core/model/hardtoken/types/EnhancedEIDHardToken.java"/>
           	<include name="org/ejbca/core/model/hardtoken/types/SwedishEIDHardToken.java"/>
           	<include name="org/ejbca/core/model/log/ProtectedLogConstants.java"/>
           	<include name="org/ejbca/core/model/hardtoken/profiles/IPINEnvelopeSettings.java"/>
           	<include name="org/ejbca/core/model/hardtoken/profiles/SwedishEIDProfile.java"/>
           	<include name="org/ejbca/core/model/ca/caadmin/extendedcaservices/CmsCAServiceInfo.java"/>
           	<include name="org/ejbca/core/model/ca/caadmin/extendedcaservices/OCSPCAServiceInfo.java"/>
           	<include name="org/ejbca/core/model/ca/caadmin/extendedcaservices/XKMSCAServiceInfo.java"/>
           	<include name="org/ejbca/core/model/ca/catoken/SoftCATokenInfo.java"/>
           	<include name="org/ejbca/core/model/ca/catoken/HardCATokenInfo.java"/>
           	<include name="org/ejbca/core/model/ca/catoken/KeyStrings.java"/>
           	<include name="org/ejbca/core/model/ca/catoken/NFastCAToken.java"/>
           	<include name="org/ejbca/util/keystore/KeyStoreContainerFactory.java"/>
        	<!-- From EJBCA External SCEP RA (including some of the classes above) -->
           	<include name="org/ejbca/core/protocol/scep/ScepRequestMessage.java"/>
           	<include name="org/ejbca/core/protocol/scep/ScepResponseMessage.java"/>
        	<!-- Dependencies from SignServer -->
        	<!-- Execute "grep "import.*org.ejbca.*" src/ -r | grep -v svn | awk '{print $2}' | tr -d ';' | sort | uniq" in the SignServer home dir to get a list of dependencies. -->
           	<include name="org/ejbca/core/ejb/JNDINames.java"/>
           	<include name="org/ejbca/model/ca/caadmin/IllegalKeyStoreException.java"/>
           	<include name="org/ejbca/model/ca/catoken/CATokenAuthenticationFailedException.java"/>
           	<include name="org/ejbca/model/ca/catoken/CATokenOfflineException.java"/>
           	<include name="org/ejbca/model/ca/catoken/ICAToken.java"/>
           	<include name="org/ejbca/model/ca/catoken/PKCS11CAToken.java"/>
           	<include name="org/ejbca/model/ca/crl/RevokedCertInfo.java"/>
           	<include name="org/ejbca/model/UpgradeableDataHashMap.java"/>
           	<include name="org/ejbca/ui/cli/util/ConsolePasswordReader.java"/>
           	<include name="org/ejbca/ui/web/pub/cluster/IHealthCheck.java"/>
           	<include name="org/ejbca/util/Base64.java"/>
           	<include name="org/ejbca/util/Base64GetHashMap.java"/>
           	<include name="org/ejbca/util/Base64PutHashMap.java"/>
           	<include name="org/ejbca/util/CertTools.java"/>
           	<include name="org/ejbca/util/JDBCUtil.java"/>
           	<include name="org/ejbca/util/keystore/KeyTools.java"/>
    	</javac>
    </target>

    <target name="compile-tests" depends="build">
    	<mkdir dir="${build-test.dir}" />
        <javac srcdir="${src-test.dir}" destdir="${build-test.dir}" debug="on" includeantruntime="no"
        	encoding="iso8859-1" target="${java.target.version}">
        	<classpath>
				<path location="${mod.ejbca-ejb.lib}" />
        		<path refid="compile.classpath"/>
        		<path refid="lib.junit.classpath"/>
        	</classpath>
    	</javac>
        <copy file="${log4j.test.file}" tofile="${build-test.dir}/log4j.xml" failonerror="true"/>
		<copy todir="${build-test.dir}" failonerror="true">
			<fileset dir="${ejbca.home}/src">
				<include name="intresources/**"/>
			</fileset>
		</copy>
    </target>

	<target name="test" depends="compile-tests" description="Run tests for this module">
    	<antcall target="showtime"/>
    	<property name="reports.dir" location="${reports.base.dir}/test"/>
		<delete dir="${reports.dir}" />
		<mkdir dir="${reports.dir}/html"/>
		<junit printsummary="yes" haltonfailure="no" dir="${this.dir}">
			<classpath>
        		<path refid="test.classpath"/>
        		<path refid="lib.clover.classpath"/>
			</classpath>
			<formatter type="xml" />
			<batchtest fork="yes" todir="${reports.dir}">
				<fileset dir="${build-test.dir}" includes="**/*.class">
					<exclude name="org/ejbca/core/model/approval/ApprovalJunitHelper*.class"/>
					<exclude name="org/ejbca/core/model/InternalResourcesTestClass.class"/>
					<exclude name="org/ejbca/core/model/util/AlgorithmToolsHelper*.class"/>
					<exclude name="org/ejbca/core/protocol/ocsp/CacheExceptionHandler.class"/>
					<exclude name="org/ejbca/core/protocol/ocsp/CacheTester.class"/>
					<exclude name="org/ejbca/core/protocol/ocsp/OcspUtilMockups*.class"/>
					<exclude name="org/ejbca/core/protocol/ocsp/OcspUtilMockups*.class"/>
				</fileset>
			</batchtest>
		</junit>
		<antcall target="createreport"/>
    	<antcall target="showtime"/>
    </target>
	
	<target name="runone" depends="compile-tests">
		<fail message="'test.runone' is not set. Example -Dtest.runone=TestApprovalExecutorUtil" unless="test.runone" />
    	<property name="reports.dir" location="${reports.base.dir}/runone"/>
		<delete dir="${reports.dir}" />
		<mkdir dir="${reports.dir}/html"/>
		<junit printsummary="yes" haltonfailure="no" >
			<classpath>
        		<path refid="test.classpath"/>
			</classpath>
			<formatter type="xml" />
			<batchtest fork="yes" todir="${reports.dir}">
				<fileset dir="${build-test.dir}">
					<include name="**/${test.runone}.class" />
				</fileset>
			</batchtest>
		</junit>
		<antcall target="createreport"/>
	</target>
</project>
